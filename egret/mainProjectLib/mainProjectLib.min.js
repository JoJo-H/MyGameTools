function dependProperty(e,t,i,n){void 0===i&&(i=[]),void 0===n&&(n=[]);var s=function(e,t,i){var s=eui.Binding.bindHandler(e,t,function(){var t=e;if(is.fun(i))i();else{var n=i.split("."),s=n.length;if(n.length>1)for(var r=0;t&&s-2>=r;)t=t[n[r]],r++;eui.PropertyEvent.dispatchPropertyEvent(t,eui.PropertyEvent.PROPERTY_CHANGE,n[s-1])}},this);n.push(s)};for(var r in t){var a=t[r];"string"==typeof a&&(a=[a]);var o=i.concat(r);if(Array.isArray(a))for(var h=a.length;h--;)s(e,o.concat([]),a[h]);else dependProperty(e,a,o,n)}return n}function _p_(e,t,i,n,s,r){return void 0===i&&(i=!0),void 0===n&&(n=!1),void 0===s&&(s=!1),void 0===r&&(r=null),{moddo:e,params:t,mask:i,cache:n,dataMerge:s,delay:r}}var AssetAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var s=RES.getRes(e);s?n(s):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},n.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.apply(this,arguments),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createChildren=function(){var i=this;e.prototype.createChildren.call(this),t.isLoading=!0,meru.localStorage.setPrefix("poker");var n=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",n),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.stage.maxTouches=1,RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var s=meru.getPlatform();if(egret.is(s,"andes.platform.IGetLocation")){var r=s;r&&r.getLocation(function(e){"success"==e.message?(LoginCallback.jingdu=e.result.longitude,LoginCallback.weidu=e.result.latitude):(LoginCallback.jingdu=-1,LoginCallback.weidu=-1)},this)}meru.res.loadRes(),meru.singleton(ReportError).init(),Stat.startLoad(),meru.addPullObject("scode",function(){return"ToAyowC8eDia~4eRr"},this),meru.addNotification("removeLoadingView",function(){i.loadingView&&(i.removeChild(i.loadingView),i.loadingView=null)},this)},n.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),meru.res.loadTheme(this.stage,!1,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("loading")},n.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},n.onResourceLoadComplete=function(e){e.groupName==this.getPreloadGroup()?(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene()):"loading"==e.groupName&&(this.loadingView=new LoadingView,this.addChildAt(this.loadingView,0),RES.loadGroup(this.getPreloadGroup()),egret.Capabilities.runtimeType==egret.RuntimeType.WEB&&window.showPro&&window.showPro(101))},n.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},n.getPreloadGroup=function(){return meru.singleton(PlatResource).preloadGroup()},n.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},n.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},n.onResourceProgress=function(e){e.groupName==this.getPreloadGroup()&&(this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal),"project_json"==e.resItem.name&&this.doLogin())},n.startCreateScene=function(){t.isLoading=!1,Stat.endLoad(),meru.postNotification("resLoadDone")},n.doLogin=function(){var e=meru.Config.get("project_json"),t=egret.getOption("svId");t&&meru.Proxy.addGlobalParams("svId",t);var i=egret.getOption("slUrl",!0);if(i)andes.login.setServerListUrl(i);else{var n=egret.getOption("pf");if(is.truthy(n)){var s=meru.Config.get("project_json","Modules.Login.Property.ServerListUrl_"+n,null);s&&andes.login.setServerListUrl(s)}}meru.Setting.init(e),meru.UI.setRoot(this),andes.login.init(),egret.Capabilities.runtimeType==egret.RuntimeType.WEB&&(console.log("stageW:"+egret.MainContext.instance.stage.stageWidth),console.log("stageH:"+egret.MainContext.instance.stage.stageHeight),console.log("innerWidth:"+window.innerWidth),console.log("innerHeight:"+window.innerHeight),console.log("clientWidth:"+document.body.clientWidth),console.log("clientHeight:"+document.body.clientHeight))},t.isLoading=!1,t}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getTheme=function(e,t,i,n){function s(e){t.call(n,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);var CardData=function(){function e(e){this._data=e}var t=__define,i=e,n=i.prototype;return t(n,"data",function(){return this._data}),t(n,"type",function(){return this._data<=52?Math.ceil(this._data/13):this._data-48+1}),t(n,"grade",function(){if(this._data<=52){var e=this._data%13;return 1==e?14:0==e?13:e}return this._data-37}),t(n,"singleGrade",function(){return this.isJoker?14:this.grade}),t(n,"color",function(){var e=this.type;return e%2==0?1:2}),t(n,"isJoker",function(){return this.type>4}),t(n,"notJoker",function(){return!this.isJoker}),t(n,"isBack",function(){return null==this._data}),t(n,"isCard",function(){return null!=this._data}),e}();egret.registerClass(CardData,"CardData");var Const=function(){function e(){}var t=(__define,e);t.prototype;return e.afterFree=function(){return e.ROOM_STATUS_PLAYING},e.beforePlay=function(t){return t==e.ROOM_STATUS_FREE},e.ROOM_STATUS_FREE=0,e.ROOM_STATUS_PLAYING=1,e.ROOM_STATUS_WAIT=2,e.ONOFF={},e.SETTING_NORMAL=1,e.SETTING_NO_SMALL=2,e.SETTING_KING=3,e.SETTING_SPECIAL=4,e.SURRENDER_NORMAL=0,e.SURRENDER_APPLY=1,e.SURRENDER_AGREE=2,e.SURRENDER_DISAGREE=3,e.bengbu="gamecenter",e.sange="sange",e.guilin="guilin",e.nanning="nanning",e.roundMap={1:6,2:12,3:18},e}();egret.registerClass(Const,"Const");var GameEvents=function(){function e(){}var t=(__define,e);t.prototype;return e.STATUS_CHANGE="status_change",e.DATA_CHANGE="data_change",e.MY_DATA_CHANGE="my_data_change",e.PASS_CHANGE="pass_change",e.SHOW_RECOMMEND="show_recommend",e.HIDE_PLAYNODE="hide_playNode",e.HIDE_SHOWNODE="hide_showNode",e.HIDE_GRABNODE="hide_grabnode",e.REFRESH_USER="refresh_user",e.USER_CHAT="user_chat",e.CHAT_CHANGE="chat_change",e.CONTINUE_STATUS="continue_status",e.AUTO_SELECT="auto_select",e}();egret.registerClass(GameEvents,"GameEvents");var Effect=function(){function e(){}var t=(__define,e);t.prototype;return e.register=function(e){this._pn=e},e.show=function(e,t){},e.showEffect=function(){var e=new eui.Image;e.source="icon_wenzi_ninzhiqianyiyoufangjian_png",e.scaleX=e.scaleY=1.5,e.anchorOffsetX=281,e.anchorOffsetY=45,e.x=meru.stage.stageWidth/2,e.y=meru.stage.stageHeight/2,meru.stage.addChild(e),egret.Tween.get(e).to({scaleX:1,scaleY:1},200).wait(1e3).call(function(){meru.display.removeFromParent(e)})},e._pn=-1,e}();egret.registerClass(Effect,"Effect");var HeadLoader=function(){function e(){this._idx=-1}var t=(__define,e),i=t.prototype;return i.init=function(e,t,i){t!=this._url&&(this._img=e,this._url=t,this._idx=i,this.startLoad())},i.startLoad=function(){if(null!=this._loader&&this._loader.removeEventListener(egret.Event.COMPLETE,this.onUrlLoaderHandler,this),-1==this._url.indexOf("http"))this._img.source=this._url;else{var e=new egret.URLRequest(this._url);this._loader=new egret.URLLoader,this._loader.addEventListener(egret.Event.COMPLETE,this.onUrlLoaderHandler,this),this._loader.dataFormat=egret.URLLoaderDataFormat.TEXTURE,this._loader.load(e)}},i.onUrlLoaderHandler=function(e){this._loader.removeEventListener(egret.Event.COMPLETE,this.onUrlLoaderHandler,this),this.resourceLoadComplete(e.currentTarget.data)},i.resourceLoadComplete=function(e){this._img.texture=e},e}();egret.registerClass(HeadLoader,"HeadLoader");var Stat=function(){function e(){}var t=(__define,e);t.prototype;return e.heartBeat=function(){if(e.isOpen&&GameUtils.isRelease()){var t=PUser.getCache("i.ezId");OpenSdk.statHeartbeat({who:t})}},e.share=function(){if(e.isOpen&&GameUtils.isRelease()){var t=PUser.getCache("i.ezId");OpenSdk.statEvent({who:t,what:"shareClick"})}},e.buy1=function(){if(e.isOpen&&GameUtils.isRelease()){var t=PUser.getCache("i.ezId");OpenSdk.statEvent({who:t,what:"buyClick1"})}},e.buy2=function(){if(e.isOpen&&GameUtils.isRelease()){var t=PUser.getCache("i.ezId");OpenSdk.statEvent({who:t,what:"buyClick2"})}},e.startLoad=function(){if(e.isOpen&&GameUtils.isRelease()){var t=egret.getOption("id");OpenSdk.statEvent({who:t,what:"startLoad"})}},e.endLoad=function(){if(e.isOpen&&GameUtils.isRelease()){var t=egret.getOption("id");OpenSdk.statEvent({who:t,what:"endLoad"})}},e.enterGame=function(){if(e.isOpen&&GameUtils.isRelease()){var t=egret.getOption("id");OpenSdk.statEvent({who:t,what:"enterGame"})}},e.isOpen=!0,e}();egret.registerClass(Stat,"Stat");var ActivityMutation=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){this.on("INVITE",this.invite),this.on("AWARD",this.award)},n.invite=function(e,t){meru.UI.addTooltip(new InviteView)},n.award=function(e,t){var i=t.input.text;i?meru.request(PInvite.getSelfAward(i)).then(function(e){0==e.status?meru.tooltip("领取成功"):meru.tooltip(e.msg||"领取失败"),meru.UI.remove(t)}):meru.tooltip("请输入ID")},t}(meru.BaseMutation);egret.registerClass(ActivityMutation,"ActivityMutation"),meru.injectionMutation("ACTIVITY",ActivityMutation);var ActivityView=function(e){function t(){e.call(this),this._refreshed=!1,meru.getPlatform().name==Const.sange?this.skinName="ActivityBengBuSkin":this.skinName="ActivitySkin"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){if(e.prototype.onEnter.call(this),meru.getPlatform().name!=Const.sange){var t=this,i=new andes.operates.TabOperate("tab");this.addOperate(i.zOrderType(andes.operates.TabOrderType.Up).addTabItem(this.buildNormalTabItem("邀请好友")).setTapCallback(function(e){"诚邀推广员"==e.label?(t.offerNode.visible=!0,t.inviteNode.visible=!1):(t.offerNode.visible=!1,t.inviteNode.visible=!0)}).select("邀请好友")),this.initInfo()}},n.buildNormalTabItem=function(e){return{label:e,onCreated:function(e){},onBeginSelect:function(){return!0}}},n.initInfo=function(){var e=GameUtils.getWXName(),t=GameUtils.getWXNumber();this.pl1.text=e+"诚招推广员",this.pl2.text="注：本次活动最终解释权归"+e+"所有",this.pl3.text="4. 开通推广员请联系微信号："+t},n.onExit=function(){e.prototype.onExit.call(this)},t}(meru.BaseComponent);egret.registerClass(ActivityView,"ActivityView");var InviteView=function(e){function t(){e.call(this),this.skinName="InviteSkin",Stat.share()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this),this.bg.touchEnabled=!0,this.bg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.initInfo()},n.onExit=function(){e.prototype.onExit.call(this),this.bg.touchEnabled=!1,this.bg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},n.initInfo=function(){var e=GameUtils.getWXName(),t=GameUtils.getWXNumber();this.pl1.text=e,this.pl2.text=e,this.pl3.text=e,this.gzh.text=t},n.onClose=function(){meru.UI.remove(this)},t}(meru.BaseComponent);egret.registerClass(InviteView,"InviteView");var UserHead=function(e){function t(){e.apply(this,arguments),this.loader=new HeadLoader}__extends(t,e);var i=(__define,t),n=i.prototype;return n.dataChanged=function(){if(e.prototype.dataChanged.call(this),this.data){this.head.visible=!0;var t=this.data.pic;1==t?this.loader.init(this.head,"head_2_png",4):this.loader.init(this.head,t,4)}else this.head.visible=!1},t}(meru.BaseComponent);egret.registerClass(UserHead,"UserHead",["eui.IItemRenderer","eui.UIComponent"]);var ChatBubble=function(e){function t(){e.apply(this,arguments),this._timeId=-1,this._list=[]}__extends(t,e);var i=(__define,t),n=i.prototype;return n.refreshView=function(e){var t=this;if(this.visible)return void this._list.push(e);if(this.visible=!0,this._data=e,this.bq.visible=!1,this.txtNode1.visible=!1,this.txtNode2.visible=!1,this.voiceNode.visible=!1,meru.clearTimeout(this._timeId),e.t==ChatConst.WORD)return this.label1.text=meru.singleton(PlatResource).message[e.ct],1==this.label1.numLines?this.showWordEffect(1,meru.singleton(PlatResource).message[e.ct]):this.showWordEffect(2,meru.singleton(PlatResource).message[e.ct]),void meru.singleton(SoundManager).playEffect("Man_Chat_"+e.ct+"_mp3");if(e.t==ChatConst.EMOJI){this.bq.visible=!0,this.bq2.source="bq"+e.ct+"_png";var i=this.bq2.y;egret.Tween.get(this.bq2).to({y:i-50},800).to({y:i},800).wait(1600).call(function(){t.hideMe()})}else if(e.t==ChatConst.VOICE)this.voiceNode.visible=!0,this.voiceLabel.text=""+e.drn+"s",this.voiceClick(),this._timeId=meru.setTimeout(function(){t.hideMe()},this,5e3);else if(e.t==ChatConst.TYPING)return this.label1.text=e.ct,void(1==this.label1.numLines?this.showWordEffect(1,e.ct):this.showWordEffect(2,e.ct))},n.showWordEffect=function(e,t){var i=this,n=1==e?2:1;this["txtNode"+e].visible=!0,this["txtNode"+n].visible=!1,this["label"+e].text=t;var s=5e3;if(2==e){this["label"+e].mask=this["maskDisplay"+e];var r=9;this["label"+e].y=r;var a=this["label"+e].numLines;if(a>2){s=5e3+2500*(a-3);for(var o=egret.Tween.get(this["label"+e]);a>2;)a-=2,o=o.wait(2e3).to({y:r-60},500),r-=60}}this._timeId=meru.setTimeout(function(){i.hideMe()},this,s)},n.hideMe=function(){this.visible=!1;var e=this._list.shift();e&&this.refreshView(e)},n.voiceClick=function(){Voice.getVoice().playVoice(this._data.ct)},n.onEnter=function(){e.prototype.onEnter.call(this)},n.onExit=function(){e.prototype.onExit.call(this)},t}(meru.BaseComponent);egret.registerClass(ChatBubble,"ChatBubble");var ChatConst=function(){function e(){}var t=(__define,e);t.prototype;return e.getEmojiDP=function(){for(var t=[],i=1;18>=i;i++)t.push({value:i,type:e.EMOJI});var n=new eui.ArrayCollection(t);return n},e.getMessageDP=function(){var t=[],i=meru.singleton(PlatResource).message;for(var n in i)t.push({type:e.WORD,value:n,mes:i[n]});var s=new eui.ArrayCollection(t);return s},e.getHistoryList=function(){var t=meru.getCache(PChat.roomList()).l;t=t.filter(function(t){return t.t!=e.WORD&&t.t!=e.EMOJI}),GameUtils.isIOSApp()&&(t=t.filter(function(t){return t.t!=e.VOICE})),t.sort(function(e,t){return e.time-t.time});var i=t.concat([]);return i},e.WORD=1,e.EMOJI=2,e.VOICE=3,e.TYPING=4,e}();egret.registerClass(ChatConst,"ChatConst");var ChatItem=function(e){function t(){e.call(this),this.skinName="ItemChatRecordSkin"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.dataChanged=function(){e.prototype.dataChanged.call(this),this.data&&(this.nameLabel.text=this.getName()+":",this.txt.visible=!1,this.voice.visible=!1,this.data.t==ChatConst.WORD?(this.txt.visible=!0,this.txt.text=meru.singleton(PlatResource).message[this.data.ct]):this.data.t==ChatConst.EMOJI||(this.data.t==ChatConst.VOICE?(this.voice.visible=!0,this.voiceLabel.text=""+this.data.drn+"s"):this.data.t==ChatConst.TYPING&&(this.txt.visible=!0,this.txt.text=this.data.ct)))},n.onEnter=function(){e.prototype.onEnter.call(this),this.voiceBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.voiceClick,this)},n.onExit=function(){e.prototype.onExit.call(this),this.voiceBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.voiceClick,this)},n.getName=function(){var e=PRoom.getCache("rus");for(var t in e)if(e[t].uId==this.data.uId)return GameUtils.formatName(e[t].nm,e[t]);return"???"},n.voiceClick=function(){Voice.getVoice().playVoice(this.data.ct)},t}(meru.BaseComponent);egret.registerClass(ChatItem,"ChatItem",["eui.IItemRenderer","eui.UIComponent"]);var ChatMutation=function(e){function t(){e.apply(this,arguments),this._historyList=null,this._lastTabName="表情"}__extends(t,e);var i=__define,n=t,s=n.prototype;return s.init=function(){e.prototype.init.call(this),this.on("OPEN",this.open),this.on("TYPING",this.typing),this.on("SELECT",this.select),meru.addNotification(GameEvents.CHAT_CHANGE,this.dataChange,this)},s.dataChange=function(){var e=ChatConst.getHistoryList();this.historyList.source=e,this.historyList.refresh()},i(s,"historyList",function(){return this._historyList||(this._historyList=new eui.ArrayCollection(ChatConst.getHistoryList())),this._historyList}),s.open=function(){var e=meru.UI.addBox("ChatSkin").setCompName("CHAT");e.addOperate(new andes.operates.TabOperate("tab").addTabItem(this.createTabItem("语音","ChatListVoiceSkin",ChatConst.getMessageDP())).addTabItem(this.createTabItem("表情","ChatListEmojiSkin",ChatConst.getEmojiDP())).addTabItem(this.createTabItem("历史","ChatListHistorySkin",this.historyList)).select(this._lastTabName)),e.addOperate(new andes.operates.TapOperate("bg",function(){meru.UI.remove(e)}))},s.createTabItem=function(e,t,i){var n=this;return{label:e,skin:t,data:i,parentName:"scrollerPosition",onShow:function(){n._lastTabName=e},onCreated:function(e){}}},s.typing=function(e,t){var i=t.input.text;if(i){if(GameUtils.getRealLength(i)>100)return void meru.tooltip("发言不能多余100个字符");var n=ChatConst.TYPING;meru.request(PChat.roomSay(n,i.replace(/\+/g,"%2B"),0)).then(function(e){meru.UI.removeByName("CHAT")})}},s.select=function(e){var t=e.type,i=e.value;meru.request(PChat.roomSay(t,i,0)).then(function(e){meru.UI.removeByName("CHAT")})},t}(meru.BaseMutation);egret.registerClass(ChatMutation,"ChatMutation"),meru.injectionMutation("CHAT",ChatMutation);var ChatView=function(e){function t(){e.call(this),this._change=!0,this.skinName="ChatSkin"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this);var t=this,i=new andes.operates.TabOperate("tab");this.addOperate(i.zOrderType(andes.operates.TabOrderType.Up).addTabItem(this.buildNormalTabItem("聊  天")).addTabItem(this.buildNormalTabItem("聊天记录")).setTapCallback(function(e){"聊  天"==e.label?(t.chatView.visible=!0,t.historyView.visible=!1):(t.chatView.visible=!1,t.historyView.visible=!0,t._change&&t.historyChange())}).select("聊  天")),this.emojiList.dataProvider=ChatConst.getEmojiDP(),this.wordList.dataProvider=ChatConst.getMessageDP(),meru.addNotification(GameEvents.CHAT_CHANGE,this.dataChange,this),meru.addNotification("CHAT.SELECT",this.chat,this),meru.addNotification("CHAT.TYPING",this.typing,this),meru.addNotification("CHAT.CLOSE",this.close,this),meru.addNotification("CHAT.VOICE",this.voice,this),this.bg.touchEnabled=!0,this.bg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},n.onClose=function(){meru.UI.remove(this)},n.onExit=function(){e.prototype.onExit.call(this),meru.removeNotification(GameEvents.CHAT_CHANGE,this.dataChange,this),meru.removeNotification("CHAT.SELECT",this.chat,this),meru.removeNotification("CHAT.TYPING",this.typing,this),meru.removeNotification("CHAT.CLOSE",this.close,this),meru.removeNotification("CHAT.VOICE",this.voice,this),this.bg.touchEnabled=!1,this.bg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},n.buildNormalTabItem=function(e){return{label:e,onCreated:function(e){}}},n.dataChange=function(){this._change=!0,0==this.tab.selectedIndex&&this.historyChange()},n.historyChange=function(){var e=this,t=ChatConst.getHistoryList(),i=this.historyList.dataProvider;i||(i=new eui.ArrayCollection),i.source=t,i.refresh(),meru.setTimeout(function(){var t=e.Scroller.viewport.contentHeight,i=t-e.Scroller.height;i>0&&(e.Scroller.viewport.scrollV=i),meru.setTimeout(function(){var i=e.Scroller.viewport.contentHeight;i!=t&&(e.Scroller.viewport.scrollV=i-e.Scroller.height)},e,50)},this,50),this._change=!1},n.voice=function(e,t,i){console.log(e),Voice.getVoice().playVoice(e.ct)},n.chat=function(e,t,i){var n=i.parent.data,s=n.type,r=n.value,a=this;meru.request(PChat.roomSay(s,r,0)).then(function(e){a.close()})},n.typing=function(){var e=this.input.text;if(e){if(GameUtils.getRealLength(e)>100)return void meru.tooltip("发言不能多余100个字符");var t=this,i=ChatConst.TYPING;meru.request(PChat.roomSay(i,e,0)).then(function(e){t.close()})}},n.close=function(){meru.UI.remove(this)},t}(meru.BaseComponent);egret.registerClass(ChatView,"ChatView");var EmojiTemplate=function(e){function t(){e.call(this),this.skinName="ItemEmojiSkin"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.dataChanged=function(){e.prototype.dataChanged.call(this),this.data&&(this.bq.source="bq"+this.data.value+"_png")},n.onExit=function(){e.prototype.onExit.call(this)},t}(meru.BaseComponent);egret.registerClass(EmojiTemplate,"EmojiTemplate",["eui.IItemRenderer","eui.UIComponent"]);var SocketSynchronize=function(){function e(){this._timeId=-1,this._chatPsid=-1}var t=(__define,e),i=t.prototype;return i.register=function(e){var t=PRoom.getCache("base.psId");t>=e||this._chatPsid!=e&&(meru.clearTimeout(this._timeId),this._chatPsid=e,this._timeId=meru.setTimeout(this.timeOut,this,3e3))},i.timeOut=function(){var e=PRoom.getCache("base.psId");e<this._chatPsid&&this.synchronize()},i.synchronize=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null),meru.request(PRoom.getInfo(!0)).then(function(){if(PRoom.getCache("rId")>0){meru.getData(QuitData).quitDataChange(),meru.singleton(GameData).myCardsChange();var i=!0,n=PRoom.getCache("base");n.st==Const.ROOM_STATUS_PLAYING?1!=PRoom.getCache("rus")[GameUtils.getMyPos()].hp&&0==meru.UI.getContainerByType(meru.UIType.COMMON).numChildren&&meru.UI.addCommon(new MyView):n.st==Const.ROOM_STATUS_WAIT&&(meru.singleton(ResultPlay).isPlaying?i=!1:(meru.postNotification(GameEvents.DATA_CHANGE),meru.singleton(ResultPlay).playEnd())),i&&GameUtils.checkBox(),meru.postNotification(GameEvents.DATA_CHANGE)}else"ReviewSkin"!=meru.UI.getScene().skinName&&(meru.UI.clearBox(),meru.UI.runScene(new HomeLayer));e&&e.call(t)})},e}();egret.registerClass(SocketSynchronize,"SocketSynchronize");var SystemChatTip=function(e){function t(){e.call(this),this._queue=[],this._showing=!1,this._idx=1,this._autoHidden=!0,this._animationType="rightToLeft",this._isEnter=!1,this.skinName="ChatMessageSkin"}__extends(t,e);var i=__define,n=t,s=n.prototype;return i(s,"autoHidden",function(){return this._autoHidden},function(e){this._autoHidden=e}),i(s,"animationType",function(){return this._animationType},function(e){this._animationType=e}),s.onEnter=function(){e.prototype.onEnter.call(this),this.visible=!1;var t=this.maskDisplay,i=new egret.Rectangle(t.x,t.y,t.width,t.height);this.rootGroup.mask=i,this._isEnter=!0,this.check()},s.show=function(e){this._queue.push(e),this.check()},s.check=function(){!this._showing&&this._isEnter&&this._queue.length>0&&(this._idx=0,this.showTalk())},s.getName=function(e){var t=PRoom.getCache("rus");for(var i in t)if(t[i].uId==e.uId)return t[i].nm;return""},s.showTalk=function(){if(this._queue.length<=0)return this._autoHidden&&(this.visible=!1),void(this._showing=!1);this.visible=!0,this._showing=!0,this._idx+=1;var e=this._idx%2+1,t=this._queue.shift(),i=this["contentLabel"+e],n=this["chatGroup"+e],s=this["chatGroup"+(1==e?2:1)];i.textFlow=(new egret.HtmlTextParser).parser(t.ct);var r=this.maskDisplay;"rightToLeft"==this._animationType?this.rightToLeft(n,r,s):this.bottomToTop(n,r,s)},s.rightToLeft=function(e,t,i){e.x=t.x+t.width,e.visible=!0;var n=t.x-e.width,s=e.x-n,r=10*s,a=meru.Animation.to(r,{x:n},Linear.easeNone);0==this._queue.length?a.call(this.showTalk,this):meru.Animation.delay(.7*r).call(this.showTalk,this).run(e),a.run(e)},s.bottomToTop=function(e,t,i){i.y==t.y&&meru.Animation.to(1e3,{y:t.y-i.height}).run(i),e.x=t.x,e.y=t.y+t.height,e.visible=!0;var n=meru.Animation.to(1e3,{y:t.y});if(e.width>t.width){var s=e.width-t.width,r=10*s;n.delay(1e3).to(r,{x:-s})}n.delay(1e3),n.call(this.showTalk,this),n.run(e)},i(t,"marquee",function(){return null==this._marquee&&(this._marquee=new t,this._marquee.skinName="ChatHomeTopMessageSkin",meru.UI.addCommon(this._marquee)),this._marquee}),t}(meru.BaseComponent);egret.registerClass(SystemChatTip,"SystemChatTip");var CardView=function(e){function t(){e.call(this),this._select=!1,this.skinName="ItemCardListSkin4"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.choose=function(){return this._select},n.selectChange=function(){this._select=!this._select,this.selectEffect()},n.setUnSelect=function(){this._select=!1,this.selectEffect()},n.selectEffect=function(){this.container.y=this._select?0:34},n.tap=function(){this.select.visible=!0},n.unTap=function(){this.select.visible=!1},n.isShowBack=function(){return this.back.visible},n.showBack=function(){this.back.visible=!0,this.container.visible=!1},n.hideBack=function(){this.back.visible=!1,this.container.visible=!0},t}(meru.BaseComponent);egret.registerClass(CardView,"CardView",["eui.IItemRenderer","eui.UIComponent"]);var CommonMutation=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){this.on("REMOVE_BOX",this.removeBox),meru.addNotification("GAME.NET",this.netInfo,this)},n.netInfo=function(){var e=new NetworkQualityView;e.skinName="PanelNetStatesSKin",meru.UI.addBox(e)},n.removeBox=function(e,t){meru.UI.remove(t)},t}(meru.BaseMutation);egret.registerClass(CommonMutation,"CommonMutation"),meru.injectionMutation("COMMON",CommonMutation);var ConfirmView=function(e){function t(){e.apply(this,arguments),this.data={}}__extends(t,e);var i=(__define,t);i.prototype;return t}(eui.Component);egret.registerClass(ConfirmView,"ConfirmView");var NetworkQuality;!function(e){e[e.none=0]="none",e[e.good=1]="good",e[e.average=2]="average",e[e.poor=3]="poor"}(NetworkQuality||(NetworkQuality={}));var NetworkQualityView=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this);var t=meru.pullObject("GET_SPEED_MS");this.speedChange(t),meru.addNotification("SPEED_CHANGE",this.speedChange,this)},n.updateText=function(e,t){this.currentState=NetworkQuality[e],this.ms=t},n.speedChange=function(e){-1e3==e?this.updateText(NetworkQuality.none,""):100>=e?this.updateText(NetworkQuality.good,e+"ms"):e>100&&200>e?this.updateText(NetworkQuality.average,e+"ms"):this.updateText(NetworkQuality.poor,e+"ms")},n.onExit=function(){e.prototype.onExit.call(this),meru.removeNotificationByTarget(this)},t}(meru.BaseComponent);egret.registerClass(NetworkQualityView,"NetworkQualityView");var RoomOption=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getOption=function(e){for(var t=1,i=1;3>=i;i++)e["radio"+i].selected&&(t=i);for(var n=Const.roundMap,s=0,r=2,i=1;4>=i;i++)e["people"+i].selected&&(r=i+1);var a=e.check1.selected,o=e.check2.selected,h=e.check3.selected;return a&&(s+=Math.pow(2,Const.SETTING_NORMAL)),o&&(s+=Math.pow(2,Const.SETTING_NO_SMALL)),h&&(s+=Math.pow(2,Const.SETTING_KING)),s+=Math.pow(2,Const.SETTING_SPECIAL),{rd:n[t],scst:s,p:r,num:t}},i.getDefault=function(){var e={},t=PRoom.getCache("rsets");if(t&&t.type){var i=!1;for(var n in Const.roundMap)Const.roundMap[n]==t.type?(e["r"+n]=!0,i=!0):e["r"+n]=!1;i||(e.r1=!0),t.aa?(e.aa=!0,e.notaa=!1):(e.aa=!1,e.notaa=!0);var s=t.setting.toString(2),r=s.length,a=s.charAt(r-2),o=s.charAt(r-3),h=s.charAt(r-4),u=s.charAt(r-5);e.sp1="1"==a,e.sp2="1"==o,e.sp3="1"==h,e.sp4="1"==u;for(var c=1;4>=c;c++)e["p"+c]=c==t.mpn-1}else e.r1=!0,e.r2=!1,e.r3=!1,e.aa=!0,e.notaa=!1,e.sp1=!0,e.sp2=!1,e.sp3=!1,e.sp4=!0,e.p1=!0,e.p2=!1,e.p3=!1,e.p4=!1;return e},e}();egret.registerClass(RoomOption,"RoomOption");var SpecialPointView=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.refreshView=function(e,t){this.score.text="+"+t,this.type.source="label_special_"+(e-100)+"_png"},t}(meru.BaseComponent);egret.registerClass(SpecialPointView,"SpecialPointView");var CreateData=function(e){function t(){e.apply(this,arguments),this.test=!1,this.other=!1}__extends(t,e);var i=__define,n=t,s=n.prototype;return s.init=function(){var e=this;this.slot("CreateRoomSkin",function(){return e}),this.slot("ChosenGameSkin",function(){return e})},i(s,"gc",function(){return PUser.getCache("i.gc")+""}),t}(meru.BaseData);egret.registerClass(CreateData,"CreateData"),meru.injectionData("CREATE",CreateData);var CreateForOtherView=function(e){function t(){e.call(this),this.skinName="CreateRoomForOtherSkin"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this),"1"==egret.getOption("czn")&&(this.payBtn.visible=!1),this.people4.group.addEventListener(eui.UIEvent.CHANGE,this.selectChange,this),this.check2.group.addEventListener(eui.UIEvent.CHANGE,this.selectChange,this)},n.onExit=function(){e.prototype.onExit.call(this),this.people4.group.removeEventListener(eui.UIEvent.CHANGE,this.selectChange,this),this.check2.group.removeEventListener(eui.UIEvent.CHANGE,this.selectChange,this)},n.selectChange=function(){this.people4.selected&&this.check2.selected&&(this.check1.selected=!0)},t}(meru.BaseComponent);egret.registerClass(CreateForOtherView,"CreateForOtherView");var CreateMutation=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){this.on("BACK",this.back),this.on("BACKBOX",this.backBox),this.on("ENTER",this.enter),this.on("ROOM_LISTS",this.roomList),this.on("SHARE",this.share),this.on("CREATE_FOR_OTHERS",this.others),this.on("FOR_OTHERS",this.forOthers)},n.share=function(e){return GameUtils.isIOSApp()?void meru.singleton(ShareListener).createShare("share",e):(meru.UI.addBox(new InviteView),void meru.singleton(ShareListener).createShare("init",e))},n.createForOthers=function(){var e=meru.singleton(RoomOption).getDefault();meru.UI.addBox(new CreateForOtherView).setData(e)},n.roomList=function(){meru.request(PRoom.getHelpList()).then(function(e){meru.UI.addBox("CreateForOthersSkin").setData(new eui.ArrayCollection(e.list))})},n.forOthers=function(e,t){var i=this,n=meru.singleton(RoomOption).getOption(t);meru.request(PRoom.createEmpty(n.rd,n.scst),!0).then(function(e){is.undefined(e.status)||0==e.status?(meru.tooltip("代开房间成功，请在列表中点击分享"),i.roomList(),meru.UI.remove(t)):meru.tooltip(e.msg||"代开房间失败")})},n.others=function(){meru.getData(CreateData).test=!0,this.createForOthers()},n.back=function(e,t){meru.UI.remove(t)},n.backBox=function(e,t){meru.UI.remove(t),meru.postNotification("HOME.CREATE")},n.enter=function(e,t){if(0!=meru.getData(CreateData).test){var i=meru.singleton(RoomOption).getOption(t),n=0,s=0;return t.cost1.selected?(s=0,n=i.rd/6*i.p):(s=1,n=i.rd/6),PUser.getCache("i.gc")<n?void meru.tooltip("房卡不够啊"):void meru.request(PRoom.createNew(i.rd,s,i.scst,i.p)).then(function(){meru.getData(CreateData).test=!1,meru.UI.remove(t),meru.UI.runScene(new GameView)})}},t}(meru.BaseMutation);egret.registerClass(CreateMutation,"CreateMutation"),meru.injectionMutation("CREATE",CreateMutation);var CreateView=function(e){function t(){e.call(this),this.skinName="CreateRoomSkin"}__extends(t,e);
var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this),"1"==egret.getOption("czn")&&(this.payBtn.visible=!1),this.people4.group.addEventListener(eui.UIEvent.CHANGE,this.selectChange,this),this.check2.group.addEventListener(eui.UIEvent.CHANGE,this.selectChange,this)},n.onExit=function(){e.prototype.onExit.call(this),this.people4.group.removeEventListener(eui.UIEvent.CHANGE,this.selectChange,this),this.check2.group.removeEventListener(eui.UIEvent.CHANGE,this.selectChange,this)},n.selectChange=function(){this.people4.selected&&this.check2.selected&&(this.check1.selected=!0)},t}(meru.BaseComponent);egret.registerClass(CreateView,"CreateView");var EnterData=function(e){function t(){e.apply(this,arguments),this.test=!1,this._show="输入房号"}__extends(t,e);var i=__define,n=t,s=n.prototype;return s.init=function(){var e=this;this.slot("EnterRoomSkin",function(){return e})},i(s,"showLabel",function(){return this._show}),s.reset=function(){this._show="输入房号",eui.PropertyEvent.dispatchPropertyEvent(this,eui.PropertyEvent.PROPERTY_CHANGE,"showLabel")},s.back=function(){"输入房号"!=this._show&&(this._show=this._show.slice(0,this._show.length-1),eui.PropertyEvent.dispatchPropertyEvent(this,eui.PropertyEvent.PROPERTY_CHANGE,"showLabel")),6==this._show.length&&meru.postNotification("ENTER.ENTER")},s.add=function(e){"输入房号"==this._show&&(this._show=""),this._show+=e+"",eui.PropertyEvent.dispatchPropertyEvent(this,eui.PropertyEvent.PROPERTY_CHANGE,"showLabel"),6==this._show.length&&meru.postNotification("ENTER.ENTER")},t}(meru.BaseData);egret.registerClass(EnterData,"EnterData"),meru.injectionData("ENTER",EnterData);var EnterMutation=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){this.on("BACK",this.back),this.on("DELETE",this.onDelete),this.on("RESET",this.reset),this.on("PRINT",this.print),this.on("ENTER",this.enter)},n.onDelete=function(){meru.getData(EnterData).back()},n.reset=function(){meru.getData(EnterData).reset()},n.print=function(e,t,i){var n=i.label;meru.getData(EnterData).add(n)},n.enter=function(e,t){if(0!=meru.getData(EnterData).test){var i=meru.getData(EnterData).showLabel;return"输入房号"==i?void meru.tooltip("请输入"):void meru.request(PRoom.joinOne(i)).then(function(e){meru.getData(EnterData).test=!1,meru.getData(EnterData).reset(),meru.UI.clearBox(),meru.UI.runScene(new GameView)}).otherwise(function(){meru.getData(EnterData).reset()})}},n.back=function(e,t){meru.getData(EnterData).reset(),meru.UI.remove(t)},t}(meru.BaseMutation);egret.registerClass(EnterMutation,"EnterMutation"),meru.injectionMutation("ENTER",EnterMutation);var FriendData=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=__define,n=t,s=n.prototype;return s.init=function(){var e=this;this.slot("InviteSkin",function(){return e})},i(s,"list",function(){return[]}),t}(meru.BaseData);egret.registerClass(FriendData,"FriendData"),meru.injectionData("FRIEND",FriendData);var FriendMutation=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t);i.prototype;return t}(meru.BaseMutation);egret.registerClass(FriendMutation,"FriendMutation"),meru.injectionMutation("FRIEND",FriendMutation);var FriendView=function(e){function t(){e.call(this),this.skinName="InviteSkin"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this),this.listener(this.dailiBtn,this.dailiClick),this.listener(this.inviteBtn,this.inviteClick),this.dailiClick()},n.onExit=function(){e.prototype.onExit.call(this),this.clearListeners()},n.dailiClick=function(){this.group2.visible=!0,this.group1.visible=!1,this.invite.visible=!1,this.daili.visible=!0},n.inviteClick=function(){this.group2.visible=!1,this.group1.visible=!0,this.invite.visible=!0,this.daili.visible=!1},t}(meru.BaseComponent);egret.registerClass(FriendView,"FriendView");var ChooseRuleView=function(e){function t(){e.call(this),this.skinName="ChosenRuleSkin"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this),this.bg.touchEnabled=!0,this.bg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.rule1.visible=meru.singleton(GameData).hasRule(Const.SETTING_NORMAL),this.rule2.visible=meru.singleton(GameData).hasRule(Const.SETTING_NO_SMALL),this.rule3.visible=meru.singleton(GameData).hasRule(Const.SETTING_KING);var t=PRoom.getCache("base.aa");this.cost1.visible=0==t,this.cost2.visible=0!=t,this.listener(this.shezhiBtn,this.shezhiClick),this.listener(this.bangzhuBtn,this.helpClick),this.shezhiClick()},n.shezhiClick=function(){this.rule.visible=!0,this.help.visible=!1,this.shezhi1.visible=!0,this.shezhi2.visible=!0},n.helpClick=function(){this.rule.visible=!1,this.help.visible=!0,this.shezhi1.visible=!1,this.shezhi2.visible=!1},n.close=function(){meru.UI.remove(this),this.bg.touchEnabled=!1,this.bg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},n.onExit=function(){e.prototype.onExit.call(this)},t}(meru.BaseComponent);egret.registerClass(ChooseRuleView,"ChooseRuleView");var GameData=function(){function e(){this._pailList=[],this._tripleList=[],this._boomList=[],this._straightList=[],this._myCards=[],this.ignore=!1,this._list1=[],this._list2=[],this._list3=[],this.selectList=[]}var t=__define,i=e,n=i.prototype;return n.myCard=function(){return this._myCards},t(n,"list1",function(){return this._list1},function(e){this._list1=e,this.myCardsChange(),this.ignore||3==this.myCard().length&&(meru.postNotification(GameEvents.SHOW_RECOMMEND,this.myCard()),meru.postNotification(GameEvents.AUTO_SELECT))}),t(n,"list2",function(){return this._list2},function(e){this._list2=e,this.myCardsChange(),this.ignore||3==this.myCard().length&&(meru.postNotification(GameEvents.SHOW_RECOMMEND,this.myCard()),meru.postNotification(GameEvents.AUTO_SELECT))}),t(n,"list3",function(){return this._list3},function(e){this._list3=e,this.myCardsChange(),this.ignore||3==this.myCard().length&&(meru.postNotification(GameEvents.SHOW_RECOMMEND,this.myCard()),meru.postNotification(GameEvents.AUTO_SELECT))}),n.boomList=function(){return this._boomList},n.pailList=function(){return this._pailList},n.tripleList=function(){return this._tripleList},n.straightList=function(){return this._straightList},n.reset=function(){this._list1=[],this._list2=[],this._list3=[],this.myCardsChange()},n.myCardsChange=function(){this._boomList=[],this._pailList=[],this._tripleList=[],this._straightList=[],this._myCards=[];var e=function(e){if(4!=e.length)return!1;for(var t=1;t<e.length;t++)if(e[0].grade!=e[t].grade)return!1;return!0},t=function(e){return 2==e.length&&e[0].grade==e[1].grade},i=function(e){return 3==e.length&&e[0].grade==e[1].grade&&e[0].grade==e[2].grade},n=PRoom.getCache("si.poker");if(n){for(var s=n.split(","),r=[],a=0;a<s.length;a++)r.push(new CardData(s[a]));r.sort(function(e,t){return t.grade==e.grade?t.type-e.type:t.grade-e.grade});for(var o=[],a=0;a<this._list1.length;a++)o.push(this._list1[a].data);for(var a=0;a<this._list2.length;a++)o.push(this._list2[a].data);for(var a=0;a<this._list3.length;a++)o.push(this._list3[a].data);r=r.filter(function(e){return-1==o.indexOf(e.data)}),this._myCards=r;for(var h={},a=0;a<r.length;a++){var u=r[a];h[u.grade]||(h[u.grade]=[]),h[u.grade].push(u)}var c=[];for(var l in h)-1==c.indexOf(h[l].length)&&c.push(h[l].length);c.sort(function(e,t){return t-e});for(var a=0;a<c.length;a++){var d=[];for(var l in h)h[l].length==c[a]&&(d=d.concat(h[l]),e(h[l])?(this._boomList.push(h[l]),this._tripleList.push(h[l].slice(0,3)),this._pailList.push(h[l].slice(0,2))):i(h[l])?(this._tripleList.push(h[l]),this._pailList.push(h[l].slice(0,2))):t(h[l])&&this._pailList.push(h[l]))}this._boomList.sort(function(e,t){return t[0].grade-e[0].grade}),this._tripleList.sort(function(e,t){return t[0].grade-e[0].grade}),this._pailList.sort(function(e,t){return t[0].grade-e[0].grade});for(var m=new ShunziRule,f=[],a=0;a<this._myCards.length;a++)(0==a||this._myCards[a].grade!=this._myCards[a-1].grade)&&f.push(this._myCards[a]);this._straightList=[];for(var a=0;a<f.length;a++){var g=f.slice(a,3+a);m.verify(g)&&this._straightList.push(g)}if(f.length>3&&14==f[0].grade&&2==f[f.length-1].grade){var g=f.slice(f.length-2,f.length);if(g.unshift(f[0]),m.verify(g)){var p=this._straightList.slice(0,1),v=this._straightList.slice(1,this._straightList.length);this._straightList=p.concat([g]).concat(v)}}meru.postNotification(GameEvents.MY_DATA_CHANGE)}},n.getSortCard=function(e){for(var t=e.split(","),i=[],n=[],s=0;s<t.length;s++)n.push(new CardData(t[s]));n.sort(function(e,t){return t.type-e.type});for(var r={},s=0;s<n.length;s++){var a=n[s];r[a.grade]||(r[a.grade]=[]),r[a.grade].push(a)}var o=[];for(var h in r)-1==o.indexOf(r[h].length)&&o.push(r[h].length);o.sort(function(e,t){return t-e});for(var s=0;s<o.length;s++){var u=[];for(var h in r)r[h].length==o[s]&&(u=u.concat(r[h]));u.sort(function(e,t){return t.grade-e.grade}),i=i.concat(u)}return i},n.selectChange=function(e){this.selectList=e},n.allSurrender=function(){var e=PRoom.getCache("rus");for(var t in e)if(0==e[t].ldo&&e[t].sudr!=Const.SURRENDER_AGREE)return!1;return!0},n.canSurrender=function(){var e=PRoom.getCache(""),t=e.rus,i=GameUtils.getMyPos();return Const.ROOM_STATUS_PLAYING!=e.base.st?!1:0==t[i].sudr?!0:!1},n.hasRule=function(e){var t=PRoom.getCache("base");if(!t)return!1;var i=t.scst,n=i.toString(2),s=n.length;return 1==n.charAt(s-1-e)},n.getMaxNumber=function(){return PRoom.getCache("base.mpn")||2},e}();egret.registerClass(GameData,"GameData");var RuleCenter=function(){function e(){this._curType=-1,this._socket=null,this._ruleList=[],this._specialList=[]}var t=__define,i=e,n=i.prototype;return n.inject=function(e){this._ruleList.push(e)},n.injectSpecial=function(e){this._specialList.push(e)},n.verify=function(e){for(var t=0;t<this._ruleList.length;t++)if(this._ruleList[t].verify(e))return this._ruleList[t];return null},n.getSpecial=function(){var e=meru.singleton(GameData),t=e.myCard().concat(e.list1).concat(e.list2).concat(e.list3);t.sort(function(e,t){return t.grade-e.grade});for(var i=[],n=!1,s=-1,r=0;r<this._specialList.length;r++)if(this._specialList[r].verify(t)){var a={};a.t=this._specialList[r].type-100,i.push(a),(this._specialList[r].type==RuleType.Shuangqingshun||this._specialList[r].type==RuleType.Sanqingshun)&&(n=!0),this._specialList[r].type==RuleType.Santonghua&&(s=i.length-1)}return n&&s>-1&&i.splice(s,1),i},n.initSocket=function(){this._socket=new SocketAnalysis1},n.init13zhang=function(){1!=this._curType&&(this._curType=1,this._ruleList=[],this.inject(new SantiaoRule),this.inject(new TonghuashunRule),this.inject(new TonghuaRule),this.inject(new ShunziRule),this.inject(new DuiziRule),this.inject(new WulongRule),this.injectSpecial(new LianshunRule),this.injectSpecial(new QinglianshunRule),this.injectSpecial(new QuanheiRule),this.injectSpecial(new QuanhongRule),this.injectSpecial(new QuansantiaoRule),this.injectSpecial(new SanqingRule),this.injectSpecial(new SanshunqingRule),this.injectSpecial(new ShuangsantiaoRule),this.injectSpecial(new ShuangshunqingRule),this.injectSpecial(new SigetouRule))},t(n,"analysis",function(){return this._socket}),n.dispose=function(){this._ruleList=[],this._socket=null},e}();egret.registerClass(RuleCenter,"RuleCenter");var Recommend1=function(){function e(){this._recommendType=-1,this._recommendIdx=0,this._recommends={},this._done=!1,this._tonghua=new TonghuaRule,this._tonghuashun=new TonghuashunRule,this._shunzi=new ShunziRule}var t=(__define,e),i=t.prototype;return i.findRecommend=function(){this._recommends={},this._done=!0,this._recommendIdx=0,this._recommends[RuleType.Tonghuashun]=this.tonghuashun().reverse(),this._recommends[RuleType.Tonghua]=this.tonghua().reverse(),this._recommends[RuleType.Shunzi]=this.shunzi().reverse(),this._recommends[RuleType.Santiao]=this.santiao().reverse()},i.tonghuashun=function(){var e=[],t=this.getLists(),i=t.normal,n=t.king,s=new ShunziRule;for(var r in i){for(var a=i[r],o=!1,h=0;h<n.length;h++)n[h].color==a[0].color&&(a=[n[h]].concat(a),o=!0);if(o)for(var u=this.recursive(a,3),h=0;h<u.length;h++)this._tonghuashun.verify(u[h])&&e.push(u[h]);else if(a.length>=3){for(var h=0;h<a.length-2;h++){var c=a.slice(h,h+3);s.verify(c)&&e.push(c)}if(a.length>3&&14==a[0].grade&&2==a[a.length-1].grade){var c=a.slice(a.length-2,a.length);c.unshift(a[0]),s.verify(c)&&e.push(c)}}}var l=this._tonghuashun;return e.sort(function(e,t){return l.compare(e,t)}),e},i.getLists=function(){for(var e=meru.singleton(GameData).myCard(),t=[],i={},n=0;n<e.length;n++)e[n].isJoker?t.push(e[n]):(i[e[n].type]||(i[e[n].type]=[]),i[e[n].type].push(e[n]));return{king:t,normal:i}},i.tonghua=function(){var e=[],t=this.getLists(),i=t.normal,n=t.king;for(var s in i){for(var r=i[s],a=0;a<n.length;a++)n[a].color==r[0].color&&(r=[n[a]].concat(r));r.length>=3&&(e=e.concat(this.recursive(r,3)))}var o=this._tonghua;return e.sort(function(e,t){return o.compare(e,t)}),e},i.recursive=function(e,t){var i=[];if(1==t){for(n=0;n<e.length;n++)i.push([e[n]]);return i}for(var n=0;n<e.length;n++){var s=e.concat([]);s.splice(0,n+1);for(var r=this.recursive(s,t-1),a=0;a<r.length;a++)i.push([e[n]].concat(r[a]))}return i},i.shunzi=function(){for(var e=[],t=meru.singleton(GameData).myCard(),i=[],n={},s=0;s<t.length;s++)t[s].isJoker?i.push(t[s]):(n[t[s].grade]||(n[t[s].grade]=[]),n[t[s].grade].push(t[s]));if(i.length>0){var r=[];for(var a in n)r.push(n[a][0]);r.sort(function(e,t){return t.grade-e.grade}),r=r.concat(i);for(var o=this.recursive(r,3),s=0;s<o.length;s++)this._shunzi.verify(o[s])&&e.push(o[s])}else e=meru.singleton(GameData).straightList();var h=this._shunzi;return e.sort(function(e,t){return h.compare(e,t)}),e},i.santiao=function(){var e=meru.singleton(GameData).tripleList();return e},i.duizi=function(){for(var e=[],t=[],i=meru.singleton(GameData).pailList(),n=0;n<i.length;n++)t.push(i[n]);for(var s=meru.singleton(GameData).myCard(),r=[],a=0;a<s.length;a++)r.push([s[a]]);for(var n=0;n<t.length;n++)for(var o=0;o<r.length;o++){var h=!0;if(r[o][0].grade==t[n][0].grade){h=!1;break}h&&e.push(t[n].concat(r[o]))}for(var u=[],c=[],n=0;n<e.length;n++){var l=!1;if(this.isPair(e[n][0])||(l=!0),!l)for(var o=2;o<e[n].length;o++)if(!this.isSingle(e[n][o])){l=!0;break}l?u.push(e[n]):c.push(e[n])}return u.concat(c)},i.isSingle=function(e){for(var t=meru.singleton(GameData).myCard(),i=0,n=0;n<t.length;n++)t[n].grade==e.grade&&(i+=1);return 1==i},i.isPair=function(e){for(var t=meru.singleton(GameData).myCard(),i=0,n=0;n<t.length;n++)t[n].grade==e.grade&&(i+=1);return 2==i},i.getRecommends=function(){return this._recommends},i.doRecommend=function(e){if(0==this._done&&this.findRecommend(),this._recommendType!=e&&(this._recommendType=e,this._recommendIdx=0),0==this._recommends[e].length)return void meru.tooltip("没有可推荐的");var t=this._recommends[e][this._recommendIdx];meru.postNotification(GameEvents.SHOW_RECOMMEND,t),this._recommendIdx+=1,this._recommendIdx>=this._recommends[e].length&&(this._recommendIdx=0)},e}();egret.registerClass(Recommend1,"Recommend1");var GameMutation=function(e){function t(){e.call(this),this.on("QUIT",this.quit),this.on("BACK",this.back),this.on("CHAT",this.chat),this.on("RULE",this.rule),this.on("COMMIT",this.commit),this.on("CANCELSPECIAL",this.cancelSpecial),this.on("CONFIRMSPECIAL",this.confirmSpecial),this.on("HISTORY",this.history)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.rule=function(){meru.UI.addBox(new ChooseRuleView)},n.chat=function(){meru.UI.addBox(new ChatView)},n.back=function(){meru.request(PRoom.leave()).then(function(){"MainSkin"==meru.UI.getScene().skinName&&(meru.UI.clearBox(),meru.UI.runScene(new HomeLayer))})},n.quit=function(){meru.request(PRoom.quit(1)).then(function(e){})},n.cancelSpecial=function(e,t){meru.UI.remove(t)},n.confirmSpecial=function(e,t){meru.request(PRoom.playCard("")).then(function(){meru.postNotification("REMOVE_TOPSCENE"),meru.UI.remove(t)})},n.commit=function(){for(var e=meru.singleton(GameData).list1,t=meru.singleton(GameData).list2,i=meru.singleton(GameData).list3,n=[],s=0;s<e.length;s++)n.push(e[s].data);for(var s=0;s<t.length;s++)n.push(t[s].data);for(var s=0;s<i.length;s++)n.push(i[s].data);var r=n.join(",");if(console.log("提交的数据:"+r),""==r){var a=PRoom.getCache("si.poker");return meru.request({moddo:"User.uploadLog",params:{logStr:"提交空字符串"+a+"嗯"}}),meru.postNotification("removeAllList"),meru.singleton(RuleCenter).analysis.reconnect(),void meru.tooltip("请重新提交")}meru.request(PRoom.playCard(r)).then(function(){meru.postNotification("REMOVE_TOPSCENE")})},n.history=function(){var e=PRoom.getCache("rId"),t=meru.getCache(PRoom.roundResults());if(t){var i=PRoom.getCache("base.st"),n=PRoom.getCache("base.rd"),s=i==Const.ROOM_STATUS_WAIT&&t.l.length==n,r=i==Const.ROOM_STATUS_PLAYING&&t.length==n-1;if(s||r)this.realHistory();else{var a=this;meru.request(PRoom.roundResults(e,!0)).then(function(){a.realHistory()})}}else{var a=this;meru.request(PRoom.roundResults(e,!0)).then(function(){a.realHistory()})}},n.realHistory=function(){meru.UI.addBox(new RoundHistoryView)},t}(meru.BaseMutation);egret.registerClass(GameMutation,"GameMutation"),meru.injectionMutation("GAME",GameMutation);var GameView=function(e){function t(){e.call(this),this._pnMap={},this._timeId=-1,this._tickId=30,this._lastTurn=-1,this._lastStatus=-1,meru.singleton(ShareListener).roomShare("init"),this.skinName="MainSkin",meru.singleton(SoundManager).getLaseBMG()&&meru.singleton(SoundManager).playBGM2(),meru.singleton(RuleCenter).init13zhang()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this),this.refreshView(),meru.addNotification(GameEvents.DATA_CHANGE,this.refreshView,this),meru.addNotification(GameEvents.REFRESH_USER,this.refreshUserView,this),meru.addNotification("BACK_HOME_BTN",this.backHomeVisible,this),meru.addNotification(GameEvents.CONTINUE_STATUS,this.continueBtnChange,this),this._timeId=meru.setInterval(this.onTick,this,1e3),this.listener(this.continueBtn,this.onContinue),this.listener(this.backHomeBtn,this.backHome),meru.singleton(RuleCenter).analysis.pushAll();var t=PRoom.getCache("base");if(t.st==Const.ROOM_STATUS_PLAYING){var i=PRoom.getCache("rus")[GameUtils.getMyPos()];1!=i.hp&&meru.setTimeout(function(){DealCard.isDealing||meru.UI.addCommon(new MyView)},this,200)}else t.st==Const.ROOM_STATUS_WAIT&&meru.singleton(ResultPlay).playEnd()},n.onExit=function(){meru.singleton(ResultPlay).stop(),DealCard.isDealing=!1,this.clearListeners(),meru.removeNotificationByTarget(this),e.prototype.onExit.call(this),meru.clearInterval(this._timeId)},n.onTick=function(){var e=PRoom.getCache("base.st"),t=[Const.ROOM_STATUS_PLAYING];t.indexOf(e)>-1?(this._tickId>0&&(this._tickId-=1),this.tick1.text=""+this._tickId,this.tick1.visible=!0):this.tick1.visible=!1},n.baseDataChange=function(){var e=PRoom.getCache(""),t=e.base;this.round.text="局数："+t.rd+"/"+t.mrd,this.room.text="房间号："+t.code,this.backBtn.visible=t.owner!=PUser.getCache("i.id")&&0==t.rd},n.refreshUserView=function(){for(var e=PRoom.getCache("rus"),t=GameUtils.getMyPos(),i=meru.singleton(GameData).getMaxNumber(),n=1;5>=n;n++){var s=t+n,r=s%5;0==r&&(r=5),this._pnMap[r]=n}for(var n=1;5>=n;n++)this["user"+this._pnMap[n]]&&this["user"+this._pnMap[n]].refreshView(e[n],this._pnMap[n]);this.user0.refreshView(e[t]),(this._lastTurn!=PRoom.getCache("base").nTurn||this._lastStatus!=PRoom.getCache("base").st)&&(this._tickId=300),this._lastTurn=PRoom.getCache("base").nTurn,this._lastStatus=PRoom.getCache("base").st;for(var a=[],n=0;i>n;n++){var o=n-(t-1);0>o&&(o+=5),a.push(o)}for(var n=0;5>n;n++)this["user"+n].visible=a.indexOf(n)>-1;this.inviteNode.visible=Object.keys(e).length<i},n.refreshView=function(){this.baseDataChange(),this.refreshUserView(),this.continueBtnChange(!1)},n.backHomeVisible=function(){this.quit.visible=!1,this.backHomeBtn.visible=!0},n.continueBtnChange=function(e){return e||RoundOverView.register?void(this.continueBtn.visible=!1):void(this.continueBtn.visible=Const.ROOM_STATUS_WAIT==PRoom.getCache("base").st&&!GameUtils.confirmed()&&PRoom.getCache("base.rd")<PRoom.getCache("base.mrd"))},n.onContinue=function(){var e=this;meru.request(PRoom.cmReady()).then(function(){console.log("我准备啦"),e.continueBtn.visible=!1})},n.backHome=function(){meru.request(PRoom.getInfo(!0)).then(function(){meru.UI.clearBox(),meru.UI.runScene(new HomeLayer)})},t}(meru.BaseComponent);egret.registerClass(GameView,"GameView");var HelpView=function(e){function t(){e.call(this),this.skinName="HelpSkin"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this)},n.dataChange=function(){this.check1.selected?(this.zhuangjia.visible=!0,this.suanfen.visible=!1):(this.zhuangjia.visible=!1,this.suanfen.visible=!0)},n.onExit=function(){e.prototype.onExit.call(this)},t}(meru.BaseComponent);egret.registerClass(HelpView,"HelpView");var MyView=function(e){function t(){e.call(this),this._list1=[],this._data1=[],this._selectList=[],this._beginCard=null,this.skinName="ArrangeSkin",meru.singleton(GameData).reset()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){if(e.prototype.onEnter.call(this),this.gameData=meru.singleton(GameData),this._selectList=[],meru.addNotification("removeAllList",this.removeAllList,this),meru.addNotification("REMOVE_TOPSCENE",this.removeMe,this),meru.addNotification(GameEvents.MY_DATA_CHANGE,this.refreshMyView,this),meru.addNotification(GameEvents.SHOW_RECOMMEND,this.doRecommend,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),this.listener(this.topCancel,this.cancel1),this.listener(this.midCancel,this.cancel2),this.listener(this.lastCancel,this.cancel3),this.part1Btn.touchEnabled=!0,this.part1Btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.partClick1,this),this.part2Btn.touchEnabled=!0,this.part2Btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.partClick2,this),this.part3Btn.touchEnabled=!0,this.part3Btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.partClick3,this),meru.addNotification(GameEvents.AUTO_SELECT,this.autoClick,this),meru.addNotification(GameEvents.DATA_CHANGE,this.dataChange,this),this.surrenderVisible(),this.afterSynchronize(),meru.display.stageW<720){var t=this.cardList1.layout;t.gap=-60+Math.ceil((meru.display.stageW-720)/13),this.tab.scaleX=meru.display.stageW/720}var i=PRoom.getCache("si.poker");i||meru.singleton(SocketSynchronize).synchronize(this.afterSynchronize,this)},n.afterSynchronize=function(){this.refreshMyView()},n.surrenderVisible=function(){this.btnVisible()},n.btnVisible=function(){this.commitBtn.right=280},n.dataChange=function(){this.surrenderVisible()},n.onExit=function(){this._list1=[],this._selectList=[],this._data1=[],meru.removeNotification("removeAllList",this.removeAllList,this),meru.removeNotification("REMOVE_TOPSCENE",this.removeMe,this),meru.removeNotification(GameEvents.MY_DATA_CHANGE,this.refreshMyView,this),meru.removeNotification(GameEvents.SHOW_RECOMMEND,this.doRecommend,this),meru.removeNotification(GameEvents.DATA_CHANGE,this.dataChange,this),meru.removeNotification(GameEvents.AUTO_SELECT,this.partClick1,this),this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.clearListeners(),this.part1Btn.touchEnabled=!1,this.part1Btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.partClick1,this),this.part2Btn.touchEnabled=!1,this.part2Btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.partClick2,this),this.part3Btn.touchEnabled=!1,this.part3Btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.partClick3,this),e.prototype.onExit.call(this)},n.removeMe=function(){meru.display.removeFromParent(this)},n.isTouchIn=function(e,t){for(var i=this._list1.length-1,n=i;n>=0;n--)if(this._list1[n].visible&&this._list1[n].$hitTest(e,t))return this._list1[n];return null},n.getList=function(e,t,i){var n,s,r=[];t>i?(n=t,s=i):i>t?(n=i,s=t):(n=t,s=t);for(var a=0;a<e.length;a++)a>=s&&n>=a&&r.push(e[a]);return r},n.showSelectEffect=function(){for(var e=0;e<this._list1.length;e++)this._list1[e].unTap();for(var e=0;e<this._selectList.length;e++)this._selectList[e].tap()},n.selectChange=function(){for(var e=0;e<this._selectList.length;e++)this._selectList[e].unTap(),this._selectList[e].selectChange();for(var t=[],e=0;e<this._list1.length;e++)this._list1[e].choose()&&t.push(this._list1[e].data);this.gameData.selectChange(t)},n.doRecommend=function(e){for(var t=0;t<this._list1.length;t++)this._list1[t].unTap(),this._list1[t].setUnSelect();this._selectList=[];for(var i=this._list1,t=0;t<e.length;t++)for(var n=0;n<i.length;n++)if(i[n].data.data==e[t].data&&-1==this._selectList.indexOf(i[n])){this._selectList.push(i[n]);break}this.selectChange()},n.touchBegin=function(e){this._beginX=e.stageX,this._beginY=e.stageY,this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this._selectList=[],this._beginCard=this.isTouchIn(this._beginX,this._beginY),this._beginCard&&this._selectList.push(this._beginCard),this.showSelectEffect()},n.touchMove=function(e){if(this._beginCard){var t=this.isTouchIn(e.stageX,e.stageY);if(t){this._selectList=[];var i=this._list1,n=i.indexOf(this._beginCard),s=i.indexOf(t);this._selectList=this.getList(i,n,s)}}this.showSelectEffect()},n.touchEnd=function(e){this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),this.touchMove(e),this.selectChange()},n.refreshMyView=function(){if(this.cardList1){var e=this.gameData.myCard();this._data1=e;var t=this.cardList1.dataProvider;t||(t=new eui.ArrayCollection),t.source=this._data1,t.refresh(),this.cardList1.validateNow(),this._list1=[];for(var i=0;i<this._data1.length;i++)this._list1.push(this.cardList1.getElementAt(i));for(var i=0;i<this._list1.length;i++)this._list1[i].unTap(),this._list1[i].setUnSelect();var n=this.topList.dataProvider;if(n||(n=new eui.ArrayCollection),n.source=this.gameData.list1,n.refresh(),this.topList.visible=this.gameData.list1.length>0,this.topCancel.visible=this.gameData.list1.length>0,this.gameData.list1.length>0){var s=meru.singleton(RuleCenter).verify(this.gameData.list1);this.topType.visible=!0,this.topType.source="label_cardType_"+s.level+"_png"}else this.topType.visible=!1;var r=this.midList.dataProvider;if(r||(r=new eui.ArrayCollection),r.source=this.gameData.list2,r.refresh(),this.midList.visible=this.gameData.list2.length>0,this.midCancel.visible=this.gameData.list2.length>0,this.gameData.list2.length>0){var s=meru.singleton(RuleCenter).verify(this.gameData.list2);this.midType.visible=!0,this.midType.source="label_cardType_"+s.level+"_png"}else this.midType.visible=!1;var a=this.lastList.dataProvider;if(a||(a=new eui.ArrayCollection),a.source=this.gameData.list3,a.refresh(),this.lastList.visible=this.gameData.list3.length>0,this.lastCancel.visible=this.gameData.list3.length>0,this.gameData.list3.length>0){var s=meru.singleton(RuleCenter).verify(this.gameData.list3);this.lastType.visible=!0,this.lastType.source="label_cardType_"+s.level+"_png"}else this.lastType.visible=!1;this._selectList=[],this.selectChange(),this.checkDone(),this.refreshSpecial()}},n.removeAllList=function(){this.cancel1(),this.cancel2(),this.cancel3()},n.cancel1=function(){this.gameData.ignore=!0,this.gameData.list1=[],this.gameData.ignore=!1},n.cancel2=function(){this.gameData.ignore=!0,this.gameData.list2=[],this.gameData.ignore=!1},n.cancel3=function(){this.gameData.ignore=!0,this.gameData.list3=[],this.gameData.ignore=!1},n.autoClick=function(){0==this.gameData.list1.length?this.partClick1():0==this.gameData.list2.length?this.partClick2():0==this.gameData.list3.length&&this.partClick3()},n.partClick1=function(){if(!(this.gameData.list1.length>0))if(3==this.gameData.selectList.length){if(this.gameData.list2.length>0){var e=meru.singleton(RuleCenter).verify(this.gameData.list2),t=meru.singleton(RuleCenter).verify(this.gameData.selectList);if(t.level>e.level)return void meru.tooltip("头道不能比中道大");if(t.level==e.level&&t.compare(this.gameData.selectList,this.gameData.list2)>0)return void meru.tooltip("头道不能比中道大")}this.gameData.list1=this.gameData.selectList}else meru.tooltip("需要3张")},n.partClick2=function(){if(!(this.gameData.list2.length>0))if(3==this.gameData.selectList.length){if(this.gameData.list1.length>0){var e=meru.singleton(RuleCenter).verify(this.gameData.list1),t=meru.singleton(RuleCenter).verify(this.gameData.selectList);if(e.level>t.level)return void meru.tooltip("中道不能比头道小");if(e.level==t.level&&e.compare(this.gameData.list1,this.gameData.selectList)>0)return void meru.tooltip("中道不能比头道小")}if(this.gameData.list3.length>0){var i=meru.singleton(RuleCenter).verify(this.gameData.list3),t=meru.singleton(RuleCenter).verify(this.gameData.selectList);if(t.level>i.level)return void meru.tooltip("中道不能比尾道大");if(t.level==i.level&&t.compare(this.gameData.selectList,this.gameData.list3)>0)return void meru.tooltip("中道不能比尾道大")}this.gameData.list2=this.gameData.selectList}else meru.tooltip("需要3张")},n.partClick3=function(){if(!(this.gameData.list3.length>0))if(3==this.gameData.selectList.length){if(this.gameData.list2.length>0){var e=meru.singleton(RuleCenter).verify(this.gameData.list2),t=meru.singleton(RuleCenter).verify(this.gameData.selectList);if(e.level>t.level)return void meru.tooltip("尾道不能比中道小");if(e.level==t.level&&e.compare(this.gameData.list2,this.gameData.selectList)>0)return void meru.tooltip("尾道不能比中道小")}this.gameData.list3=this.gameData.selectList}else meru.tooltip("需要3张")},n.refreshSpecial=function(){if(meru.singleton(GameData).hasRule(Const.SETTING_SPECIAL)){var e=meru.singleton(RuleCenter).getSpecial(),t=this.xiList.dataProvider;t||(t=new eui.ArrayCollection),t.source=e,t.refresh()}},n.checkDone=function(){this.commitBtn.enabled=0==this.gameData.myCard().length,this.btnVisible()},t}(meru.BaseComponent);egret.registerClass(MyView,"MyView");var SelectTab=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this),meru.addNotification(GameEvents.MY_DATA_CHANGE,this.reset,this);for(var t=2;5>=t;t++)this["cardType"+t].data={cardType:t},this.listener(this["cardType"+t],this["doRec"+t]);this.reset()},n.onExit=function(){e.prototype.onExit.call(this),meru.removeNotificationByTarget(this),this.clearListeners()},n.reset=function(){meru.singleton(Recommend1).findRecommend();var e=meru.singleton(Recommend1).getRecommends();for(var t in e)this["cardType"+t].enabled=e[t].length>0},n.doRec2=function(){meru.singleton(Recommend1).doRecommend(2)},n.doRec3=function(){meru.singleton(Recommend1).doRecommend(3)},n.doRec4=function(){meru.singleton(Recommend1).doRecommend(4)},n.doRec5=function(){meru.singleton(Recommend1).doRecommend(5)},t}(meru.BaseComponent);egret.registerClass(SelectTab,"SelectTab");var ShowCardView=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.refreshView=function(e,t,i){this.visible=!0;var n=meru.singleton(RuleCenter).verify(e);this.cardType.source="label_cardType_"+n.type+"_png";for(var s=0;s<e.length;s++)this["card"+s].setData(e[s]);i>=0?(this.score.text="+"+i,this.score.font="point_yellow_font_fnt"):(this.score.text=""+i,this.score.font="point_blue_font_fnt")},t}(meru.BaseComponent);egret.registerClass(ShowCardView,"ShowCardView");var UserView=function(e){function t(){e.call(this),this._loader=new HeadLoader,this._click=!1,this._tempScore=0,this._voiceTick=-1,this._voiceTime=-1,this._mvList1=[],this._isDealing=!1}__extends(t,e);
var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this),meru.addNotification(GameEvents.STATUS_CHANGE,this.refreshHead,this),meru.addNotification(GameEvents.USER_CHAT,this.chat,this),this.listener(this.infoBtn,this.info),this.touchArea&&(this.touchArea.touchEnabled=!0,this.touchArea.addEventListener(egret.TouchEvent.TOUCH_TAP,this.cardReview,this))},n.onExit=function(){meru.removeNotification(GameEvents.STATUS_CHANGE,this.refreshHead,this),meru.removeNotification(GameEvents.USER_CHAT,this.chat,this),this.clearListeners(),this.touchArea&&(this.touchArea.touchEnabled=!1,this.touchArea.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.cardReview,this)),e.prototype.onExit.call(this)},n.cardReview=function(){var e=PRoom.getCache("base");if(e.st==Const.ROOM_STATUS_PLAYING&&this._data&&this._data.uId==PUser.getCache("i.id")){this._click=!0;for(var t=PRoom.getCache("si.poker").split(","),i=0;9>i;i++)this["card"+i].isShowBack()?(this["card"+i].hideBack(),this["card"+i].setData(new CardData(t[i]))):this["card"+i].showBack()}},n.info=function(){this._data&&this._data.uId!=PUser.getCache("i.id")&&meru.postNotification("INFO.OPEN",this._data)},n.refreshView=function(e,t){if(void 0===t&&(t=0),this._data=e,this._idx=t,this.cardList.visible=!1,t>0){if(!e)return void(this.baseContainer.visible=!1);this.baseContainer.visible=!0}var i=PRoom.getCache("base");this.score.text=""+e.tsc,this._tempScore=0,this.refreshHead(),this.palyerName.text=GameUtils.formatName(e.nm,e),this.arranging.visible=!1,this.special.visible=!1,this.curScore.visible=!1,this.showCard.visible=!1,this.point.visible=!1,this.firstPoint.visible=!1,this.midPoint.visible=!1,this.lastPoint.visible=!1,console.log("这是刷新了"),this.ready.visible=!1,i.st==Const.ROOM_STATUS_FREE?this._click=!1:i.st==Const.ROOM_STATUS_PLAYING?1==e.hp?(this.cardList.visible=!0,this._click||this.allShowBack()):this._isDealing||DealCard.isDealing||(this.arranging.visible=!0):(this._click=!1,this.point.visible=!0,this.cardList.visible=!0,this.ready.visible=1==e.cm,this.refreshCurScore(this._data.lsc),this.refreshCardList())},n.refreshCardList=function(){for(var e=this._data.shPai.split(","),t=0;9>t;t++)this["card"+t].hideBack(),this["card"+t].setData(new CardData(e[t]));var i=this._data.lwd.daos;this.refreshScore(this.firstPoint,i[0]),this.refreshScore(this.midPoint,i[1]),this.refreshScore(this.lastPoint,i[2])},n.refreshScore=function(e,t){e.visible=!0,t>=0?(e.text="+"+t,e.font="point_yellow_font_fnt"):(e.text=t,e.font="point_blue_font_fnt")},n.refreshCurScore=function(e){this.curScore.visible=!0,e>=0?(this.curScore.text="+"+e,this.curScore.font="point_yellow_font_fnt"):(this.curScore.text=e+"",this.curScore.font="point_blue_font_fnt")},n.refreshHead=function(){this._data&&(this._data.uId==PUser.getCache("i.id")&&(Const.ONOFF.d||(Const.ONOFF.d={}),Const.ONOFF.d[this._data.pn]=1),Const.ONOFF.d&&(1==Const.ONOFF.d[this._data.pn]?(this.offline.visible=!1,1==this._data.pic?1==this._data.ldo?this._loader.init(this.head,"head_1_png",this._idx):this._loader.init(this.head,"head_2_png",this._idx):this._loader.init(this.head,this._data.pic,this._idx),Const.ONOFF.v&&Const.ONOFF.v[this._data.pn]?(console.log("说话中"),this._data.uId!=PUser.getCache("i.id")&&this.addVoiceTick()):(console.log("说话结束"),this.removeVoiceTick())):(Const.ONOFF.v&&(Const.ONOFF.v[this._data.pn]=0),this.removeVoiceTick(),console.log("离线"),this.offline.visible=!0,1==this._data.pic?1==this._data.ldo?this._loader.init(this.head,"head_1_png",this._idx):this._loader.init(this.head,"head_2_png",this._idx):this._loader.init(this.head,this._data.pic,this._idx))))},n.voiceTick=function(){var e=["语音.","语音..","语音..."];this._voiceTime+=1,this._voiceTime>2&&(this._voiceTime=0),this.voiceLabel.text=e[this._voiceTime]},n.addVoiceTick=function(){meru.clearInterval(this._voiceTick),this.yuyin.visible=!0,this._voiceTime=-1,this._voiceTick=meru.setInterval(this.voiceTick,this,300),this.voiceTick()},n.removeVoiceTick=function(){this.yuyin.visible=!1,meru.clearInterval(this._voiceTick)},n.chat=function(e){this._data&&this._data.uId==e.uId&&(console.log(this._data.nm+"说了type:"+e.t+"ct:"+e.ct),this.bubble.refreshView(e))},n.showScore=function(){this.score.text=""+this._data.tsc},n.allShowBack=function(){for(var e=0;9>e;e++)this["card"+e].showBack()},n.hideAll=function(e){this._click=!1,this.cardList.visible=!0,this.allShowBack(),this.arranging.visible=!1},n.showCards=function(e,t,i){for(var n=this,s=meru.singleton(GameData).getSortCard(t),r=0;r<s.length;r++)this["card"+(r+e)].hideBack(),this["card"+(r+e)].setData(s[r]),this["card"+(r+e)].visible=!1;var a={0:0,3:1,6:2},o=["showTop","showMid","showLast"],h=["firstPoint","midPoint","lastPoint"],u=a[e];this.showCard.refreshView(s,u,i),this.showCard.bottom=this[o[u]].bottom,meru.setTimeout(function(){if(PRoom.getCache("base")){for(var t=0;t<s.length;t++)n["card"+(t+e)].visible=!0;n.showCard.visible=!1,n.scoreChange(i),n.point.visible=!0;for(var t=0;u>=t;t++)n[h[u]].visible=!0;n.refreshScore(n[h[u]],i)}},this,1e3)},n.scoreChange=function(e){this._tempScore+=e,this.refreshCurScore(this._tempScore)},n.showSpecial=function(e,t){var i=this;this.special.visible=!0,this.special.refreshView(e,t),meru.setTimeout(function(){if(PRoom.getCache("rus")){for(var e=meru.singleton(GameData).getMaxNumber()-1,n=meru.UI.getScene(),s=0;5>s;s++){var r=n["user"+s];r&&r._data&&(r._data.uId==i._data.uId?r.scoreChange(t):r.scoreChange(-t/e))}i.special.visible=!1}},this,1e3)},n.playDealMovie=function(){this._isDealing=!0,this._mvList1=[],this.arranging.visible=!1,this.dealNode.removeChildren();for(var e=0;9>e;e++)meru.setTimeout(this.playMovie1,this,150*e,e)},n.playMovie1=function(e){if(this.dealNode){var t=meru.getTypePool("fapai",meru.Movie).pop("fapai");t.scaleX=t.scaleY=.72,t.play("1"),t.x=23*e+45,t.y=58,this.dealNode.addChild(t),this._mvList1.push(t),this._data.uId==PUser.getCache("i.id")&&meru.singleton(SoundManager).playEffect("deal_mp3")}if(8==e)for(this._isDealing=!1,this.arranging.visible=!0;this._mvList1.length>0;){var i=this._mvList1.shift();meru.display.removeFromParent(i),meru.getTypePool("fapai",meru.Movie).push(i)}},t}(meru.BaseComponent);egret.registerClass(UserView,"UserView");var VoiceView=function(e){function t(){e.apply(this,arguments),this._isSend=!1}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this),this.voiceBtn.visible=!1,this.initVoice(),meru.addNotification("uploadVoiceDone",this.uploadVoiceDone,this),meru.addNotification("voiceRecordTimeOut",this.voiceRecordTimeOut,this),meru.addNotification("afterStopVoice",this.afterStop,this)},n.onExit=function(){e.prototype.onExit.call(this),this.clearVoice(),meru.removeNotification("uploadVoiceDone",this.uploadVoiceDone,this),meru.removeNotification("voiceRecordTimeOut",this.voiceRecordTimeOut,this),meru.removeNotification("afterStopVoice",this.afterStop,this)},n.initVoice=function(){this.base.visible=!1,GameUtils.isRelease()&&GameUtils.isIOS()&&!GameUtils.isIOSApp()&&(this.voiceBtn.visible=!0,this.voiceBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this))},n.clearVoice=function(){GameUtils.isRelease()&&GameUtils.isIOS()&&(this.voiceBtn.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),this.voiceBtn.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),this.voiceBtn.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),meru.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),meru.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this))},n.touchBegin=function(e){var t=Voice.getVoice().startRecord();return t?(this.base.visible=!0,this.voiceBtn.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),this.voiceBtn.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),this.voiceBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),meru.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),meru.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.touchMove(e),this._mv||(this._mv=new meru.Movie("voice","voice"),this._mv.x=190,this._mv.y=200,this.cancelGroup.addChild(this._mv),this._mv.play("1")),void VoiceEvent.start()):void meru.tooltip("上次录音未结束")},n.touchMove=function(e){this._isSend=e.stageY<600,this.sendGroup.visible=this._isSend,this.cancelGroup.visible=!this._isSend},n.touchEnd=function(e){this.base.visible=!1,meru.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),meru.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.voiceBtn.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),this.voiceBtn.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.voiceBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),e&&Voice.getVoice().stopRecord()},n.afterStop=function(){var e=this;this._isSend?(Voice.getVoice().cleanRecord(),VoiceEvent.end()):(Voice.getVoice().uploadVoice(),this.voiceBtn.enabled=!1,meru.setTimeout(function(){e.voiceBtn.enabled=!0,VoiceEvent.end()},this,200))},n.uploadVoiceDone=function(e,t){meru.request(PChat.roomSay(ChatConst.VOICE,e,t)).then(function(){})},n.voiceRecordTimeOut=function(){this.touchEnd(null),this.afterStop()},t}(meru.BaseComponent);egret.registerClass(VoiceView,"VoiceView");var BaseStep=function(){function e(e){void 0===e&&(e=null),this._isStop=!1,this._tickId=-1,this._next=e}var t=(__define,e),i=t.prototype;return i.getViewByUID=function(e){for(var t=meru.UI.getScene(),i=0;5>i;i++){var n=t["user"+i];if(n&&n._data&&n._data.uId==e)return n}return null},i.getViewIdxByUID=function(e){for(var t=meru.UI.getScene(),i=0;5>i;i++){var n=t["user"+i];if(n&&n._data&&n._data.uId==e)return i}return null},i.execute=function(){this._isStop=!1,meru.singleton(ResultPlay).currentStep=this},i.stop=function(){this._isStop=!0,meru.clearTimeout(this._tickId)},i.onTick=function(e){void 0===e&&(e=1e3),this._tickId=meru.setTimeout(this.onNext,this,e)},i.onNext=function(){this._next?this._next.execute():(meru.singleton(ResultPlay).isPlaying=!1,GameUtils.checkBox(),console.log("播放结束啦~~~"),meru.singleton(ResultPlay).currentStep=null,meru.postNotification(GameEvents.DATA_CHANGE))},e}();egret.registerClass(BaseStep,"BaseStep");var DealCard=function(){function e(){}var t=(__define,e),i=t.prototype;return i.execute=function(e){void 0===e&&(e=PRoom.getCache("rus"));for(var t in e){var i=this.getViewByUID(e[t].uId);i&&i.playDealMovie()}meru.setTimeout(this.step,this,2e3)},i.step=function(){meru.UI.addCommon(new MyView),e.isDealing=!1},i.getViewByUID=function(e){for(var t=meru.UI.getScene(),i=0;5>i;i++){var n=t["user"+i];if(n&&n._data&&n._data.uId==e)return n}return null},e.isDealing=!1,e}();egret.registerClass(DealCard,"DealCard");var ResultPlay=function(){function e(){this.isPlaying=!1,this.curScore=0,this.curScoreList=[],this.step5=new Step5,this.step4=new Step4(this.step5),this.step3=new Step3(this.step4),this.step2=new Step2(this.step3),this.step1=new Step1(this.step2)}var t=(__define,e),i=t.prototype;return i.setData=function(){this.isPlaying=!0,meru.singleton(SoundManager).playEffect("showCard_mp3"),this.start()},i.start=function(){this.stop(),this.step1.execute()},i.stop=function(){this.currentStep&&this.currentStep.stop()},i.playEnd=function(){},e}();egret.registerClass(ResultPlay,"ResultPlay");var Step1=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.execute=function(){e.prototype.execute.call(this);var t=PRoom.getCache("rus");for(var i in t){var n=this.getViewByUID(t[i].uId);n&&n.hideAll(1==t[i].sudr)}this.onTick()},t}(BaseStep);egret.registerClass(Step1,"Step1");var Step2=function(e){function t(){e.apply(this,arguments),this.stepIdx=0}__extends(t,e);var i=(__define,t),n=i.prototype;return n.execute=function(){e.prototype.execute.call(this),this.show()},n.show=function(){var e=PRoom.getCache("rus");for(var t in e){var i=e[t],n=this.getViewByUID(i.uId);n&&this.showEffect(n,i.shPai,i.lwd.daos[this.stepIdx])}this.onTick(1500)},n.showEffect=function(e,t,i){var n=t.split(","),s=n.slice(0,3);console.log(e+"--头道--"+s),e.showCards(0,s.join(","),i)},t}(BaseStep);egret.registerClass(Step2,"Step2");var Step3=function(e){function t(){e.apply(this,arguments),this.stepIdx=1}__extends(t,e);var i=(__define,t),n=i.prototype;return n.showEffect=function(e,t,i){var n=t.split(","),s=n.slice(3,6);console.log(e+"--中道--"+s),e.showCards(3,s.join(","),i)},t}(Step2);egret.registerClass(Step3,"Step3");var Step4=function(e){function t(){e.apply(this,arguments),this.stepIdx=2}__extends(t,e);var i=(__define,t),n=i.prototype;return n.showEffect=function(e,t,i){var n=t.split(","),s=n.slice(6,9);console.log(e+"--尾道--"+s),e.showCards(6,s.join(","),i)},t}(Step2);egret.registerClass(Step4,"Step4");var Step5=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.execute=function(){e.prototype.execute.call(this);var t=PRoom.getCache("rus"),i=0;for(var n in t){var s=t[n].lwd.spls||{};if(Object.keys(s).length>0){var r=t[n],a=this.getViewByUID(r.uId);if(a)for(var o in s)this.delay(a,o,s[o],i),i+=1100}}meru.setTimeout(this.onTick,this,i)},n.delay=function(e,t,i,n){meru.setTimeout(function(){PRoom.getCache("base")&&e.showSpecial(t,i)},this,n)},t}(BaseStep);egret.registerClass(Step5,"Step5");var BuyCardGuide=function(e){function t(){e.call(this),this.skinName="BuyCardSkin"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this),this.initInfo()},n.initInfo=function(){meru.getPlatform().name==Const.bengbu?(this.sgyx.visible=!1,this.pl1.visible=!0,this.pl2.text="蚌埠软件",this.bgTips.source="icon_tips_3_png"):meru.getPlatform().name==Const.sange?(this.pl2.text="三哥游戏",this.sgyx.visible=!0,this.pl1.visible=!1,this.bgTips.source="icon_tips_5_png"):(this.pl2.text="桂林棋牌屋",this.sgyx.visible=!1,this.pl1.visible=!1,this.bgTips.visible=!1)},t}(meru.BaseComponent);egret.registerClass(BuyCardGuide,"BuyCardGuide");var HomeData=function(e){function t(){e.apply(this,arguments),this._inited=!1}__extends(t,e);var i=__define,n=t,s=n.prototype;return s.init=function(){var e=this;this.slot("StartSkin",function(){return e})},s.initEvents=function(){this._inited||(this._inited=!0,dependProperty(this,{p:{gc:"gc",mlnew:"newMail"}}))},i(s,"newMail",function(){return this.p.mlnew}),i(s,"notice",function(){return this.p.gonggao}),i(s,"p",function(){return this.initEvents(),PUser.getCache("i")}),i(s,"nNa",function(){return GameUtils.formatName(this.p.nNa,this.p)}),i(s,"gc",function(){return this.p.gc}),t}(meru.BaseData);egret.registerClass(HomeData,"HomeData"),meru.injectionData("HOME",HomeData);var HomeLayer=function(e){function t(){e.call(this),meru.singleton(ShareListener).friendShare("init"),meru.singleton(SoundManager).getLaseBMG()&&meru.singleton(SoundManager).playBGM1(),meru.singleton(RuleCenter).analysis.cleanPushData(),this.skinName="StartSkin"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.resize=function(){var e=egret.MainContext.instance.stage.stageWidth,t=egret.MainContext.instance.stage.stageHeight;console.log("width:"+e),console.log("height:"+t),this.width=e,this.height=t},n.onEnter=function(){meru.postNotification("REMOVE_TOPSCENE"),"1"==egret.getOption("czn")&&(this.currentState="apple");var t=PUser.getCache("i.pic"),i=new HeadLoader;1==t?i.init(this.head,"head_2_png",4):i.init(this.head,t,4),"1"!=egret.getOption("czn")&&(this._mv1=meru.getTypePool("UIEffect",meru.Movie).pop("UIEffect"),this._mv1.x=100,this._mv1.y=47,this._mv1.play("1"),this.bottomNode.addChild(this._mv1)),this._mv2=meru.getTypePool("UIEffect",meru.Movie).pop("UIEffect"),"1"!=egret.getOption("czn")?(this._mv2.x=400,this._mv2.y=47):(this._mv2.x=327,this._mv2.y=46),this._mv2.play("2"),this.bottomNode.addChild(this._mv2),this._mv3=meru.getTypePool("UIEffect",meru.Movie).pop("UIEffect"),this._mv3.x=130,this._mv3.y=120,this._mv3.play("3"),this.middleNode.addChild(this._mv3),this._mv4=meru.getTypePool("UIEffect",meru.Movie).pop("UIEffect"),this._mv4.x=130,this._mv4.y=466,this._mv4.play("4"),this.middleNode.addChild(this._mv4),this._mv5=meru.getTypePool("UIEffect",meru.Movie).pop("UIEffect"),this._mv5.x=130,this._mv5.y=811,this._mv5.play("5"),this.middleNode.addChild(this._mv5),e.prototype.onEnter.call(this)},n.onExit=function(){this._mv1&&(meru.display.removeFromParent(this._mv1),meru.getTypePool("UIEffect",meru.Movie).push(this._mv1)),meru.display.removeFromParent(this._mv2),meru.display.removeFromParent(this._mv3),meru.display.removeFromParent(this._mv4),meru.display.removeFromParent(this._mv5),meru.getTypePool("UIEffect",meru.Movie).push(this._mv2),meru.getTypePool("UIEffect",meru.Movie).push(this._mv3),meru.getTypePool("UIEffect",meru.Movie).push(this._mv4),meru.getTypePool("UIEffect",meru.Movie).push(this._mv5),e.prototype.onExit.call(this)},t}(meru.BaseComponent);egret.registerClass(HomeLayer,"HomeLayer");var HomeMutation=function(e){function t(){e.apply(this,arguments),this._lastRID=-1}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){this.on("CREATE",this.createRoom),this.on("ENTER",this.enterRoom),this.on("RECHARGE",this.recharge),this.on("SHARE",this.share),this.on("ACTIVITY",this.activity),this.on("QUESTION",this.question),this.on("RULE",this.rule),this.on("SETTING",this.setting),this.on("REVIEW",this.review)},n.createRoom=function(){meru.getData(CreateData).test=!0;var e=meru.singleton(RoomOption).getDefault();e.gc=PUser.getCache("i.gc")+"",meru.UI.addBox(new CreateView).setData(e)},n.enterRoom=function(){meru.getData(EnterData).test=!0,meru.UI.addBox("EnterRoomSkin")},n.share=function(){return GameUtils.isIOSApp()?void meru.singleton(ShareListener).roomShare("share"):void(egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE?OpenSdk.startShare():meru.UI.addCommon(new InviteView))},n.activity=function(){meru.UI.addBox(new ActivityView)},n.question=function(){var e={},t=GameUtils.getWXName(),i=GameUtils.getWXNumber();e.tip1="购买房卡："+t+"【微信公众号】",e.tip2="客服专线："+t+"【微信公众号】",e.tip3="推广员招募："+i+" 【微信】",meru.UI.addBox("PromptSkin").setData(e)},n.rule=function(){meru.UI.addBox(new HelpView)},n.setting=function(){meru.UI.addBox(new SettingView)},n.review=function(){meru.request(PRoom.historyList(!0)).then(function(){meru.UI.addBox(new HistoryView)})},n.recharge=function(){return console.log("充值"),"bearjoy"==meru.getPlatform().name?(meru.getData(RechargeGuideData).reset(),void meru.UI.addBox(new BuyCardGuide)):void(1==PUser.getCache("i.subscribe")?meru.postNotification("RECHARGE.RECHARGE"):(meru.getData(RechargeGuideData).reset(),meru.UI.addBox(new BuyCardGuide),Stat.buy2()))},t}(meru.BaseMutation);egret.registerClass(HomeMutation,"HomeMutation"),meru.injectionMutation("HOME",HomeMutation);var IdentifyMutation=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){this.on("SURE",this.sure)},n.sure=function(e,t){},t}(meru.BaseMutation);egret.registerClass(IdentifyMutation,"IdentifyMutation");var FaceButton=function(e){function t(){e.apply(this,arguments),this.icon=""}__extends(t,e);var i=(__define,t);i.prototype;return t}(meru.Button);egret.registerClass(FaceButton,"FaceButton");var InfoItemInfo=function(e){function t(t){e.call(this),this._p=t,this._watch=eui.Watcher.watch(this._p,["ads"],this.updateAds,this)}__extends(t,e);var i=__define,n=t,s=n.prototype;return s.destory=function(){this._watch&&this._watch.unwatch()},s.updateAds=function(){meru.propertyChange(this,"ads")},i(s,"ads",function(){return this.isUnknow(this._p)?"该用户拒绝显示详细地理位置\n（请谨慎选择牌友以防止作弊）":"位置:"+this._p.ads}),i(s,"p",function(){return this._p}),s.showType=function(){},s.isUnknow=function(e){return-1==e.jd&&-1==e.wd?!0:0==e.jd&&0==e.wd?!0:!1},i(s,"distance",function(){if(this.p&&InfoData.lastUserData){if(this.isUnknow(this.p)||this.isUnknow(InfoData.lastUserData))return"距离 无法确定";var e=new qq.maps.LatLng(this.p.wd,this.p.jd),t=new qq.maps.LatLng(InfoData.lastUserData.wd,InfoData.lastUserData.jd),i=qq.maps.geometry.spherical.computeDistanceBetween(e,t);return 1e3>i?"距离"+parseInt(i)+"米":"距离"+(i/1e3).toFixed(2)+"公里"}return"距离 无法确定"}),i(s,"nm",function(){return GameUtils.formatName(this.p.nm,this.p)}),i(s,"isFlag",function(){if(this.p&&InfoData.lastUserData){var e=new qq.maps.LatLng(this.p.wd,this.p.jd),t=new qq.maps.LatLng(InfoData.lastUserData.wd,InfoData.lastUserData.jd),i=qq.maps.geometry.spherical.computeDistanceBetween(e,t);if(20>=i)return!0}return!1}),s.toRad=function(e){return e*Math.PI/180},t}(egret.EventDispatcher);egret.registerClass(InfoItemInfo,"InfoItemInfo");var InfoData=function(e){function t(){e.call(this)}__extends(t,e);var i=(__define,t);i.prototype;return t.canRefresh=function(){var e=PRoom.getCache("rus");for(var t in e){var i=e[t];if(is.truthy(i.jd)&&is.truthy(i.wd)&&is.falsy(i.ads))return!0}return!1},t.getFaceType=function(e){for(var t in this.faceType)if(this.faceType[t]==e)return t;return null},t.faceType={flower:2,boom:1},t}(meru.BaseData);egret.registerClass(InfoData,"InfoData"),meru.injectionData("INFO",InfoData);var MovieClip=egret.MovieClip,InfoMutation=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){this.on("DYNAMIC_FACE",this.dynamicFace),this.on("OPEN",this.open),this.on("FACE_ANIM",this.faceAnim)},n.faceAnim=function(e){for(var t=this,i=e.uId,n=e.toId.split(","),s=this.getViewByUID(i),r=meru.UI.getScene(),a=new egret.Point,o=0;o<n.length;o++){var h=n[o],u=this.getViewByUID(h);if(s&&u){var c=new eui.Image("info_face_"+InfoData.getFaceType(e.ct)+"_png");c.anchorOffsetX=c.width/2,c.anchorOffsetY=c.height/2,a=meru.display.localTolocal(s.width/2,s.height/2,s,r,a),c.x=a.x,c.y=a.y,r.addChild(c),a=meru.display.localTolocal(u.width/2,u.height/2,u,r,a);var l=a.x,d=a.y;egret.Tween.get(c).to({x:a.x,y:a.y},1e3).call(function(){meru.display.removeFromParent(c);var i=new meru.Movie("hudong");i.play(e.ct),r.addChild(i),i.once(meru.MovieEvent.COMPLETE,function(){meru.display.removeFromParent(i)},t),i.x=l,i.y=d})}}},n.getViewByUID=function(e){for(var t=meru.UI.getScene(),i=0;4>i;i++){var n=t["user"+i];if(n&&n._data&&n._data.uId==e)return n.infoBtn}return null},n.open=function(e){var t=this;InfoData.lastUserData=e;var i=function(){var i=meru.UI.addBox("UserInfoSkin");i.addOperate(new andes.operates.EnterOperate(function(){var t=new HeadLoader;1==e.pic?1==e.ldo?t.init(i.head,"head_1_png",99):t.init(i.head,"head_2_png",99):t.init(i.head,e.pic,99)},t));var n={info:new InfoItemInfo(e),rus:t.getRusCollection(e.uId)};i.setData(n),i.addOperate(new andes.operates.ExitOperate(function(){n.info.destory();for(var e=0;e<n.rus.length;e++)n.rus.source[e].destory()},t)),i.setCompName("INFO_BOX")};InfoData.canRefresh()?meru.request(PRoom.refreshAddress()).then(function(){i()}):i()},n.getRusCollection=function(e){var t=PRoom.getCache("rus"),i=[];for(var n in t)t[n].uId!=e&&i.push(new InfoItemInfo(t[n]));return new eui.ArrayCollection(i)},n.dynamicFace=function(e,t,i,n){var s=InfoData.faceType[n],r=PUser.getCache("i.id");if(t.data.info.p.uId==r){console.log("给其他人发");var a=PRoom.getCache("").rus,o=[];for(var h in a){var u=a[h];u.uId!=r&&o.push(u.uId)}if(0==o.length)return void meru.tooltip("无玩家加入，无法发送动态表情");meru.request(PChat.roomSay(5,s,0,o.join(",")))}else meru.request(PChat.roomSay(5,s,0,e.info.p.uId));meru.UI.removeByName("INFO_BOX")},t}(meru.BaseMutation);egret.registerClass(InfoMutation,"InfoMutation"),meru.injectionMutation("INFO",InfoMutation);var LoadingView=function(e){function t(){e.call(this);var t='<?xml version="1.0" encoding="utf-8"?>\n<e:Skin class="LoadingSkin" width="720" height="1280" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing">\n	<w:Config id="15990e6fe2e"/>\n	<e:Image source="bg_loading_jpg" y="0" id="bg1"/>\n	<e:Image source="icon_wenzi_jiazaizhong_png" y="1007" id="bg2"/>\n	<e:Group y="1068" id="bg3">\n		<e:ProgressBar id="bar" x="0" y="0" scaleX="1" scaleY="1">\n			<e:Skin>\n				<e:Image source="bg_loading_progress_bg_png" top="0" left="0" right="0"/>\n				<e:Image source="icon_loading_progress_png" id="thumb" y="4" left="5" right="5"/>\n			</e:Skin>\n		</e:ProgressBar>\n		<e:Group id="container" x="0" y="20" />\n	</e:Group>\n</e:Skin>';this.skinName=t}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this),this._mv=new meru.Movie("loading","loading"),this._mv.y=-10,this.container.addChild(this._mv),this._mv.play("1"),this.bg1.x=(meru.stage.stageWidth-1280)/2,this.bg2.x=(meru.stage.stageWidth-259)/2,this.bg3.x=(meru.stage.stageWidth-594)/2,this.setProgress(0,100)},n.setProgress=function(e,t){this.bar.maximum=t,this.bar.value=e,this._mv.x=594*(e/t)},t}(meru.BaseComponent);egret.registerClass(LoadingView,"LoadingView");var MailData=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=__define,n=t,s=n.prototype;return s.init=function(){var e=this;this.slot("PanelMailSkin",function(){return e})},i(s,"list",function(){return this._source||(this._source=new eui.ArrayCollection),this._source.source=meru.getCache(PMail.getList()).l,this._source.refresh(),this._source}),s.dataChange=function(){eui.PropertyEvent.dispatchPropertyEvent(this,eui.PropertyEvent.PROPERTY_CHANGE,"canAwd"),eui.PropertyEvent.dispatchPropertyEvent(this,eui.PropertyEvent.PROPERTY_CHANGE,"canNotAwd"),eui.CollectionEvent.dispatchCollectionEvent(this._source,eui.CollectionEvent.COLLECTION_CHANGE,eui.CollectionEventKind.RESET)},i(s,"canAwd",function(){for(var e=meru.getCache(PMail.getList()).l,t=0;t<e.length;t++)if(e[t].fk>0&&0==e[t].isAw)return!0;return!1}),i(s,"canNotAwd",function(){for(var e=meru.getCache(PMail.getList()).l,t=0;t<e.length;t++)if(e[t].fk>0&&0==e[t].isAw)return!1;return!0}),t}(meru.BaseData);egret.registerClass(MailData,"MailData"),meru.injectionData("MAIL",MailData);var MailItem=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.dataChanged=function(){this.data&&(this.full.visible=!this.data.isAw,this.empty.visible=this.data.isAw,this.st.text=this.data.isAw?"已领取":"可领取",this.title.text=this.data.title)},t}(meru.ItemRenderer);egret.registerClass(MailItem,"MailItem");var MailMutation=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){this.on("READ",this.read),this.on("OPEN",this.open),this.on("AWARDALL",this.awardAll),this.on("AWARD",this.award)},n.open=function(){meru.request(PMail.getList(!0,!0,!1,{time:30})).then(function(){meru.UI.addBox("PanelMailSkin")})},n.read=function(e){var t={};t.canAwd=0==e.isAw,t.canNotAwd=1==e.isAw,t.content=e.content,t.fk=e.fk,t.mId=e.mId,t.hasAwd=e.fk>0,meru.UI.addBox("PanelMailDetailSkin").setData(t)},n.awardAll=function(){meru.request(PMail.awardAll()).then(function(){meru.tooltip("领取成功"),meru.getData(MailData).dataChange()})},n.award=function(e,t){meru.request(PMail.award(e.mId)).then(function(){meru.tooltip("领取成功"),t.take.visible=!1,t.queding.visible=!0,meru.getData(MailData).dataChange()})},t}(meru.BaseMutation);egret.registerClass(MailMutation,"MailMutation"),meru.injectionMutation("MAIL",MailMutation);var GameOverItem=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.dataChanged=function(){if(this.data){var e=this.data.pic,t=new HeadLoader;1==e?t.init(this.head,"head_2_png",4):t.init(this.head,e,5),this.nameLabel.text=GameUtils.formatName(this.data.nm,this.data),this.maxScore.text=""+this.data.msc,this.winLose.text=this.data.wn+"胜"+this.data.fn+"负",this.totalScore.text=this.data.tsc+"分",this.me.visible=this.data.uId==PUser.getCache("i.id"),this.normal.visible=this.data.uId!=PUser.getCache("i.id"),this.data.tsc>0?this.icon.source="icon_result_round_1_png":this.data.tsc<0?this.icon.source="icon_result_round_2_png":this.icon.source="icon_result_round_3_png",this.owner.visible=this.data.uId==PRoom.getCache("base.owner")}},t}(meru.ItemRenderer);egret.registerClass(GameOverItem,"GameOverItem");var GameOverShare=function(e){function t(t){e.call(this),this._data=t,this.skinName="GameOverShareSkin"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this);var t=this._data.rus,i=[];for(var n in t)i.push(t[n]);this.list.dataProvider=new eui.ArrayCollection(i);var s=egret.getOption("resultId");s=s.split("_")[1],this.roomId.text="房间号:"+s,this.time.text=GameUtils.formatTime1(),this.listener(this.closeBtn,this.close)},n.onExit=function(){e.prototype.onExit.call(this),this.clearListeners()},n.close=function(){meru.UI.remove(this)},t}(meru.BaseComponent);egret.registerClass(GameOverShare,"GameOverShare");var GameOverShareTipSkin=function(e){function t(){if(e.call(this),this.skinName="GameOverSharePromptSkin",Stat.share(),GameUtils.isIOSApp()){var t=PUser.getCache("i.id")+"_"+PRoom.getCache("base.code");meru.singleton(ShareListener).resultShare("share",t)}}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this),this.bg.touchEnabled=!0,this.bg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.initInfo()},n.onExit=function(){e.prototype.onExit.call(this),this.bg.touchEnabled=!1,this.bg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},n.initInfo=function(){var e=GameUtils.getWXName(),t=GameUtils.getWXNumber();this.pl1.text=e,this.pl2.text=e,this.pl3.text=e,this.gzh.text=t},n.onClose=function(){meru.UI.remove(this)},t}(meru.BaseComponent);egret.registerClass(GameOverShareTipSkin,"GameOverShareTipSkin");var GameOverView=function(e){function t(){e.call(this),this.skinName="GameOverSkin2"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this);var t=PRoom.getCache("rus"),i=[];for(var n in t)i.push(t[n]);this.list.dataProvider=new eui.ArrayCollection(i),this.roomId.text="房间号:"+PRoom.getCache("base.code"),this.time.text=GameUtils.formatTime1();var s=PUser.getCache("i.id")+"_"+PRoom.getCache("base.code");meru.singleton(ShareListener).resultShare("init",s),this.listener(this.closeBtn,this.close),this.listener(this.shareBtn,this.share)},n.onExit=function(){e.prototype.onExit.call(this),this.clearListeners()},n.share=function(){meru.UI.addBox(new GameOverShareTipSkin)},n.close=function(){meru.UI.remove(this),meru.postNotification("BACK_HOME_BTN")},t}(meru.BaseComponent);egret.registerClass(GameOverView,"GameOverView");var RoundMutation=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){this.on("CONFIRM",this.confirm),this.on("CHECK",this.check)},n.confirm=function(e,t){var i=PRoom.getCache("base");i.mrd<=i.rd?meru.request(PRoom.getInfo(!0)).then(function(){meru.UI.remove(t)}):meru.request(PRoom.cmReady()).then(function(){meru.UI.remove(t)})},n.check=function(e,t){meru.UI.remove(t)},t.showed=!1,t}(meru.BaseMutation);egret.registerClass(RoundMutation,"RoundMutation"),meru.injectionMutation("ROUND",RoundMutation);var RoundOverItem=function(e){function t(){e.apply(this,arguments),this._loader=new HeadLoader}__extends(t,e);var i=(__define,t),n=i.prototype;return n.dataChanged=function(){if(this.data){this.nameLabel.text=GameUtils.formatName(this.data.nm,this.data),this.data.lsc>0?this.score.text="+"+this.data.lsc:this.score.text=this.data.lsc+"",1==this.data.pic?1==this.data.ldo?this._loader.init(this.head,"head_1_png",4):this._loader.init(this.head,"head_2_png",4):this._loader.init(this.head,this.data.pic,4);for(var e=[],t=this.data.lwd.daos,i=this.data.lwd.spls,n=["头墩","中墩","尾墩"],s=0;s<t.length;s++)t[s]>=0?e.push(n[s]+"+"+t[s]):e.push(n[s]+t[s]);for(var r in i)e.push(getRuleName(r)+"+"+i[r]);var a;a=this.data.history?this.data.history:PRoom.getCache("rus");var o=Object.keys(a).length-1,h=0;for(var r in a)if(a[r].uId!=this.data.uId){var u=a[r].lwd.spls;for(var c in u)h+=u[c]/o
}h>0&&e.push("喜牌-"+h);var l=this.list.dataProvider;l||(l=new eui.ArrayCollection),l.source=e,l.refresh()}},t}(meru.ItemRenderer);egret.registerClass(RoundOverItem,"RoundOverItem");var ScoreDetailItem=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.dataChanged=function(){this.data&&(this.txt.text=this.data)},t}(meru.ItemRenderer);egret.registerClass(ScoreDetailItem,"ScoreDetailItem");var RoundOverView=function(e){function t(t){void 0===t&&(t=null),e.call(this),this._d=t,this.skinName="GameOverSkin1"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this);var t;t=this._d?this._d:PRoom.getCache("rus");var i=[];for(var n in t){var s=t[n];this._d&&(s.history=this._d),i.push(s)}this.list.dataProvider=new eui.ArrayCollection(i),this.listener(this.viewBtn,this.view),this.listener(this.goonBtn,this.goon);var r=t[GameUtils.getMyPos()],a="";a=r.lsc>0?"icon_result_1_png":"icon_result_2_png",this.bg1.source=a,meru.postNotification(GameEvents.CONTINUE_STATUS,!0)},n.onExit=function(){t.register=!1,e.prototype.onExit.call(this),this.clearListeners(),meru.postNotification(GameEvents.CONTINUE_STATUS,!1)},n.view=function(){RoundMutation.showed=!0,meru.UI.remove(this)},n.goon=function(){if(this._d)return void meru.UI.remove(this);var e=this;meru.request(PRoom.cmReady()).then(function(){meru.UI.remove(e)})},t.register=!1,t}(meru.BaseComponent);egret.registerClass(RoundOverView,"RoundOverView");var QuitData=function(e){function t(){e.apply(this,arguments),this._isRound=!1}__extends(t,e);var i=__define,n=t,s=n.prototype;return s.init=function(){var e=this;this.slot("EndRoomSkin",function(){return e})},s.setRound=function(e){this._isRound=e,meru.UI.addBox(new QuitView).setCompName("EndRoomSkin")},i(s,"roundOver",function(){return this._isRound}),i(s,"isQuit",function(){return!this._isRound}),i(s,"notChoose",function(){for(var e=this.p,t=1;4>=t;t++)if(e[t]&&e[t].uId==PUser.getCache("i.id"))return 0==e[t].qt;return!1}),s.quitDataChange=function(){meru.postNotification("QuitDataChange"),eui.PropertyEvent.dispatchPropertyEvent(this,eui.PropertyEvent.PROPERTY_CHANGE,"notChoose")},i(s,"p",function(){return PRoom.getCache("rus")||{}}),t}(meru.BaseData);egret.registerClass(QuitData,"QuitData"),meru.injectionData("QUIT",QuitData);var QuitMutation=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){this.on("ACCEPT",this.accept),this.on("REFUSE",this.refuse),this.on("OVER",this.over)},n.accept=function(){meru.request(PRoom.quit(1)).then(function(){})},n.refuse=function(){meru.request(PRoom.quit(-1)).then(function(){})},n.over=function(){meru.request(PRoom.getInfo(!0)).then(function(){meru.UI.clearBox(),meru.UI.runScene(new HomeLayer)})},t}(meru.BaseMutation);egret.registerClass(QuitMutation,"QuitMutation"),meru.injectionMutation("QUIT",QuitMutation);var QuitView=function(e){function t(){e.call(this),this._timeId=-1,this.skinName="EndRoomSkin"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this),this._timeRecorder=new meru.TimeRecorder;var t=PRoom.getCache("base");t&&(t.qtt+=1,this._timeId=meru.setInterval(this.onTick,this,1e3),this.onTick(),meru.addNotification("QuitDataChange",this.refreshList,this),this.refreshList())},n.onTick=function(){var e=this._timeRecorder.tick(),t=PRoom.getCache("base");return t?(t.qtt-=e,t.qtt<0&&(t.qtt=0),void(this.timeLabel.text=GameUtils.formatTime3(t.qtt))):(meru.clearInterval(this._timeId),void(this._timeRecorder=null))},n.refreshList=function(){var e=PRoom.getCache("rus")||{},t=[];for(var i in e){var n={};n.isMe=PUser.getCache("i.id")==e[i].uId,n.quit=1==e[i].qt,n.refuse=-1==e[i].qt,n.name=e[i].nm,n.score=e[i].tsc,t.push(n)}var s=this.list.dataProvider;s||(s=new eui.ArrayCollection),s.source=t,s.refresh()},n.onExit=function(){e.prototype.onExit.call(this),meru.clearInterval(this._timeId),this._timeRecorder=null},t}(meru.BaseComponent);egret.registerClass(QuitView,"QuitView");var RankData=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=__define,n=t,s=n.prototype;return i(s,"rank",function(){var e=meru.getCache(PFriend.getList()).l;return e.sort(function(e,t){return t.ww!=e.ww?t.ww-e.ww:t.whlw-e.whlw}),e}),t}(meru.BaseData);egret.registerClass(RankData,"RankData"),meru.injectionData("RANK",RankData);var RankItem=function(e){function t(){e.call(this),this._loader=new HeadLoader,this.skinName="ItemRankListSkin"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.dataChanged=function(){e.prototype.dataChanged.call(this),this.data&&(this.nameLabel.text=GameUtils.formatName(this.data.uName,this.data),this.lastWeekLabel.text="本周胜局:"+this.data.ww,this.maxLabel.text=this.data.whlw+"连胜",this.itemIndex<3?this.rank.source="bg_rank_"+(this.itemIndex+1)+"_png":this.rank.source="bg_rank_4_png",1==this.data.pic?this._loader.init(this.head,"head_1_png",4):this._loader.init(this.head,this.data.pic,4),this.rankLabel.text=this.itemIndex+1)},t}(meru.BaseComponent);egret.registerClass(RankItem,"RankItem",["eui.IItemRenderer","eui.UIComponent"]);var RankMutation=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){this.on("HELP",this.help)},n.help=function(){meru.UI.addBox(new InviteView)},t}(meru.BaseMutation);egret.registerClass(RankMutation,"RankMutation"),meru.injectionMutation("RANK",RankMutation);var RankView=function(e){function t(){e.call(this),this.skinName="RankListSkin"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this),t.needRefresh&&this.refreshData(),t.needRefresh=!1,this.refreshList()},n.refreshList=function(){var e=PUser.getCache("i.id"),t=meru.getData(RankData).rank,i=this.list.dataProvider;i||(i=new eui.ArrayCollection),i.source=t,i.refresh(),this.list.visible=t.length>0;for(var n=0,s=0;s<t.length;s++)if(e==t[s].uId){n=s+1;break}this.myRank.text="我的排名:"+n},n.refreshData=function(){var e=this;meru.request(PUser.backHome()).then(function(){e.refreshList()})},n.onExit=function(){e.prototype.onExit.call(this),t.needRefresh=!0},t.needRefresh=!0,t}(meru.BaseComponent);egret.registerClass(RankView,"RankView");var PaymentRefreshProxy=function(){function e(e){this._times=[2,5,10,20,40,60],this._isDispose=!1,this._time=e}var t=(__define,e),i=t.prototype;return i.start=function(){this._times.length>0&&!this._isDispose&&(this._timeId=meru.setTimeout(this.startProxy,this,1e3*this._times.shift()))},i.startProxy=function(){},i.onResponse=function(e){var t=e.order;0==t?this.start():meru.tooltip("充值到账")},i.dispose=function(){meru.clearTimeout(this._timeId),this._isDispose=!0},e.start=function(t){e._cur&&e._cur.dispose(),e._cur=new e(t),e._cur.start()},e._cur=null,e}();egret.registerClass(PaymentRefreshProxy,"PaymentRefreshProxy");var RechargeGuideData=function(e){function t(){e.apply(this,arguments),this._curPage=1,this._maxPage=4}__extends(t,e);var i=__define,n=t,s=n.prototype;return s.init=function(){var e=this;this.slot("BuyCardSkin",function(){return e})},s.reset=function(){this._curPage=1},s.onLeft=function(){this._curPage-=1,this._curPage<1&&(this._curPage=1),this.dataChange()},s.onRight=function(){this._curPage+=1,this._curPage>this._maxPage&&(this._curPage=this._maxPage),this.dataChange()},s.dataChange=function(){eui.PropertyEvent.dispatchPropertyEvent(this,eui.PropertyEvent.PROPERTY_CHANGE,"is1"),eui.PropertyEvent.dispatchPropertyEvent(this,eui.PropertyEvent.PROPERTY_CHANGE,"is2"),eui.PropertyEvent.dispatchPropertyEvent(this,eui.PropertyEvent.PROPERTY_CHANGE,"is3"),eui.PropertyEvent.dispatchPropertyEvent(this,eui.PropertyEvent.PROPERTY_CHANGE,"is4"),eui.PropertyEvent.dispatchPropertyEvent(this,eui.PropertyEvent.PROPERTY_CHANGE,"not1"),eui.PropertyEvent.dispatchPropertyEvent(this,eui.PropertyEvent.PROPERTY_CHANGE,"not4")},i(s,"not1",function(){return!this.is1}),i(s,"not4",function(){return!this.is4}),i(s,"is1",function(){return 1==this._curPage}),i(s,"is2",function(){return 2==this._curPage}),i(s,"is3",function(){return 3==this._curPage}),i(s,"is4",function(){return 4==this._curPage}),t}(meru.BaseData);egret.registerClass(RechargeGuideData,"RechargeGuideData"),meru.injectionData("RECHARGEGUIDE",RechargeGuideData);var RechargeGuideMutation=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){this.on("LEFT",this.left),this.on("RIGHT",this.right)},n.left=function(){meru.getData(RechargeGuideData).onLeft()},n.right=function(){meru.getData(RechargeGuideData).onRight()},t}(meru.BaseMutation);egret.registerClass(RechargeGuideMutation,"RechargeGuideMutation"),meru.injectionMutation("RECHARGEGUIDE",RechargeGuideMutation);var RechargeMutation=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.init=function(){this.on("RECHARGE",this.recharge)},n.recharge=function(){if("1"!=egret.getOption("czn")){if(0==PUser.getCache("i.isAgent")){if(!PInvite.isCache()){var e=this;return void meru.request(PInvite.getInfo(!0)).then(function(){e.recharge()})}if(!PInvite.getCache("awded"))return void meru.UI.addBox("InviteCodeSkin")}var t=PUser.getCache("i"),i={};i.uId=t.platId,i.appid=103,i.goodsId=1,i.goodsNumber=1,i.serverId=1,i.ext=103,meru.getPlatform().payment(i,function(e){0==e.result?meru.tooltip("充值完成，稍后到账"):meru.tooltip("充值失败")})}},t}(meru.BaseMutation);egret.registerClass(RechargeMutation,"RechargeMutation"),meru.injectionMutation("RECHARGE",RechargeMutation);var HistoryItemView=function(e){function t(){e.call(this),this._open=!1}__extends(t,e);var i=(__define,t),n=i.prototype;return n.dataChanged=function(){if(e.prototype.dataChanged.call(this),this.data){this.room.text="房号: "+this.data.code,this.time.text="时间:"+GameUtils.formatTime2(1e3*this.data.time);var t=PUser.getCache("i.id"),i=0,n=[];for(var s in this.data.rus){var r=this.data.rus[s];t==r.uId&&(i=r.tsc),n.push(r)}this._l=n,this.showList(),i>0?this.icon.source="icon_result_round_1_png":0>i?this.icon.source="icon_result_round_2_png":this.icon.source="icon_result_round_3_png",this.detailBtn.visible=n.length>4}},n.onEnter=function(){e.prototype.onEnter.call(this),this.listener(this.checkBtn,this.check),this.listener(this.detailBtn,this.detail),this.reviewBtn&&this.listener(this.reviewBtn,this.reviewClick)},n.onExit=function(){e.prototype.onExit.call(this),this.clearListeners()},n.showAll=function(){var e=this.list.dataProvider;e.source=this._l,e.refresh(),this.detailBtn.scaleY=-1},n.showSome=function(){var e=this.list.dataProvider;e.source=this._l.slice(0,4),e.refresh(),this.detailBtn.scaleY=1},n.detail=function(){this.reviewBtn?(this._open=!this._open,this.showList()):(HistoryView.openMap[this.data.code]?HistoryView.openMap[this.data.code]=!1:HistoryView.openMap[this.data.code]=!0,this.showList())},n.showList=function(){this.reviewBtn?this._open?this.showAll():this.showSome():HistoryView.openMap[this.data.code]?this.showAll():this.showSome()},n.check=function(){var e=this.data;meru.UI.clearBox(),meru.UI.addBox(new HistoryRoundView(e))},n.reviewClick=function(){var e=this.data.rId,t=e;meru.request(PRoom.getReplay(t)).then(function(e){1==e.est?(ReviewController.rpId=t,ReviewController.setData(e)):meru.tooltip("录像丢失")})},t}(meru.BaseComponent);egret.registerClass(HistoryItemView,"HistoryItemView",["eui.IItemRenderer","eui.UIComponent"]);var ItemRecordDetail1=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.dataChanged=function(){this.data&&(this.data.hasOwnProperty("test")||(this.name1.text=GameUtils.formatName(this.data.uName,this.data)+": ",this.data.uId==PUser.getCache("i.id")?this.name1.textColor=16776960:this.name1.textColor=16777215,this.score1.text=this.data.tsc+""))},t}(meru.ItemRenderer);egret.registerClass(ItemRecordDetail1,"ItemRecordDetail1");var HistoryRoundItemView=function(e){function t(){e.call(this),this.skinName="ItemGameRecordSkin2"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this),this.listener(this.shareBtn,this.shareClick),this.listener(this.detailBtn,this.detailClick)},n.onExit=function(){e.prototype.onExit.call(this),this.clearListeners()},n.detailClick=function(){HistoryRoundView.openMap[this.data.idx]?HistoryRoundView.openMap[this.data.idx]=!1:HistoryRoundView.openMap[this.data.idx]=!0,this.showList()},n.dataChanged=function(){if(e.prototype.dataChanged.call(this),this.data){this.xiangxiBtn.visible=!1,this.detailBtn.visible=!0;var t=this.data.rus,i=[];for(var n in t){var s={};s.lsc=this.data.d.pns[n],s.uName=t[n].uName,s.uId=t[n].uId,i.push(s)}this._l=i,this.showList(),this.detailBtn.visible=i.length>4}},n.showList=function(){HistoryRoundView.openMap[this.data.idx]?this.showAll():this.showSome()},n.showAll=function(){var e=this.list.dataProvider;e.source=this._l,e.refresh(),this.detailBtn.scaleY=-1},n.showSome=function(){var e=this.list.dataProvider;e.source=this._l.slice(0,4),e.refresh(),this.detailBtn.scaleY=1},n.shareClick=function(){if(GameUtils.isIOSApp()){var e=this.data.rId,t=PUser.getCache("i.nNa"),i=PUser.getCache("i.pic");return void meru.singleton(ShareListener).reviewShare("share",e,t,i)}meru.tooltip("请在回看界面分享")},t}(meru.BaseComponent);egret.registerClass(HistoryRoundItemView,"HistoryRoundItemView",["eui.IItemRenderer","eui.UIComponent"]);var ItemRecordDetail2=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.dataChanged=function(){this.data&&(this.data.hasOwnProperty("test")||(this.name1.text=GameUtils.formatName(this.data.uName,this.data),this.score1.text=this.data.lsc+"",this.data.uId==PUser.getCache("i.id")?this.name1.textColor=16776960:this.name1.textColor=16777215))},t}(meru.ItemRenderer);egret.registerClass(ItemRecordDetail2,"ItemRecordDetail2");var HistoryRoundView=function(e){function t(t){e.call(this),this.data=t,this.skinName="GameRecordSkin2"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this),this.listener(this.backBtn,this.check);for(var t=[],i=this.data.rrs,n=0;n<i.length;n++){var s={};s.rId=this.data.rId,s.d=i[n],s.rus=this.data.rus,t.push(s)}var r=new eui.ArrayCollection(t);this.list.dataProvider=r,this.topView.setData(this.data)},n.onExit=function(){t.openMap={},e.prototype.onExit.call(this),this.clearListeners()},n.check=function(){this.close()},n.close=function(){meru.UI.remove(this),meru.UI.addBox(new HistoryView)},t.openMap={},t}(meru.BaseComponent);egret.registerClass(HistoryRoundView,"HistoryRoundView");var HistoryView=function(e){function t(){e.call(this),this.skinName="GameRecordSkin1"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this);var t=meru.getCache(PRoom.historyList()).l.concat([]);t.sort(function(e,t){return t.time-e.time});var i=new eui.ArrayCollection(t);this.list.dataProvider=i,this.listener(this.checkBtn,this.check)},n.onExit=function(){t.openMap={},e.prototype.onExit.call(this)},n.check=function(){meru.UI.addBox(new ReviewCodeView)},t.openMap={},t}(meru.BaseComponent);egret.registerClass(HistoryView,"HistoryView");var Review=function(e){function t(){e.call(this),this._pnMap={},this._idx=0,this._max=10,this._myPos=1,this.skinName="ReviewSkin";var t,i,n=ReviewController.data.rus,s=PUser.getCache("i.id");for(var r in n)n[r].uId==s&&(t=r),"1"==r&&(i=n[r]);var a,o;t?(o=PUser.getCache("i.nNa"),a=PUser.getCache("i.pic")):(o=i.uName,a=i.pic),meru.singleton(ShareListener).reviewShare("init",ReviewController.rpId,o,a),meru.singleton(RuleCenter).init13zhang()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this),this.listener(this.quitBtn,this.quit),this.listener(this.preBtn,this.prev),this.listener(this.nextBtn,this.next),this.initPosition(),this.baseInfo(),this._idx=0,this._max=ReviewController.data.rounds.length,this.next()},n.onExit=function(){e.prototype.onExit.call(this),this.clearListeners()},n.prev=function(){this._idx-=1,this.preBtn.enabled=this._idx>1,this.nextBtn.enabled=!this.isOver(),this.refreshView()},n.next=function(){this._idx+=1,this.preBtn.enabled=this._idx>1,this.nextBtn.enabled=!this.isOver(),this.refreshView()},n.isOver=function(){return this._idx>=this._max},n.baseInfo=function(){var e=ReviewController.data;this.room.text="房间号:"+e.code,this.rvId.text="回看码:"+ReviewController.rpId;var t=ReviewController.curRule();1==t[1]?this.moshi.text="算分模式":1==t[0]?this.moshi.text="庄：房主":this.moshi.text="庄：黑桃A"},n.quit=function(){meru.UI.runScene(new HomeLayer)},n.initPosition=function(){var e,t,i=ReviewController.data.rus,n=PUser.getCache("i.id");for(var s in i)i[s].uId==n&&(e=s),"1"==s&&(t=s);e=parseInt(e),e||(e=parseInt(t));for(var r=1;5>=r;r++){var a=e+r,o=a%5;0==o&&(o=5),this._pnMap[r]=o}this._myPos=e;for(var h=[],u=ReviewController.maxUser(),r=0;u>r;r++){var c=r-(e-1);0>c&&(c+=5),h.push(c)}for(var r=0;5>r;r++)this["user"+r].visible=h.indexOf(r)>-1},n.refreshView=function(){this.round.text="第"+this._idx+"/"+this._max+"局";for(var e=ReviewController.data.rounds[this._idx-1],t=1;5>=t;t++)this["user"+t]&&e[this._pnMap[t]]&&this["user"+t].refreshView(e[this._pnMap[t]],this._pnMap[t]);this.user0.refreshView(e[this._myPos],this._myPos)},t}(meru.BaseComponent);egret.registerClass(Review,"Review");var ReviewCodeView=function(e){function t(){e.call(this),this.skinName="ReviewOtherPlayerSkin"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this);var i=egret.getOption("rvId");i&&t.auto&&(this.input.text=i),t.auto=!1,this.listener(this.sureBtn,this.sure)},n.onExit=function(){e.prototype.onExit.call(this),this.clearListeners()},n.sure=function(){var e=parseInt(this.input.text);return e?void meru.request(PRoom.getReplay(e)).then(function(t){1==t.est?(ReviewController.rpId=e,ReviewController.setData(t)):meru.tooltip("录像丢失")}):void meru.tooltip("请输入正确的录像ID")},t.auto=!0,t}(meru.BaseComponent);egret.registerClass(ReviewCodeView,"ReviewCodeView");var ReviewController=function(){function e(){}var t=(__define,e);t.prototype;return e.setData=function(e){this.data=e,meru.UI.clearBox(),meru.UI.runScene(new Review)},e.getName=function(e){return GameUtils.formatName(this.data.rus[e].uName,this.data.rus[e])},e.getHead=function(e){return this.data.rus[e].pic},e.getRole=function(e){return this.data.rus[e].ldo},e.curRule=function(){var t=e.data.setting,i=t.toString(2),n=i.length,s=i.charAt(n-2),r=i.charAt(n-3);return[s,r]},e.maxUser=function(){return Object.keys(this.data.rus).length},e.data={},e.rpId=-1,e}();egret.registerClass(ReviewController,"ReviewController");var ReviewUserView=function(e){function t(){e.apply(this,arguments),this._loader=new HeadLoader}__extends(t,e);var i=(__define,t),n=i.prototype;return n.refreshView=function(e,t){this._data=e;var i=ReviewController.data.rus[t];this.palyerName.text=GameUtils.formatName(i.uName,i);var n=ReviewController.data.rus[t].pic,s=e.ldo;s?this.headBg.source="bg_head_1_png":this.headBg.source="bg_head_2_png",this.refreshHead(n,s),this.score.text=e.tsc,e.sc>=0?(this.curScore.text="+"+e.sc,this.curScore.font="point_yellow_font_fnt"):(this.curScore.text=e.sc+"",this.curScore.font="point_blue_font_fnt"),this.showResult()},n.refreshHead=function(e,t){1==e?1==t?this._loader.init(this.head,"head_1_png",4):this._loader.init(this.head,"head_2_png",4):this._loader.init(this.head,e,4)},n.showResult=function(){for(var e=this._data.poker.split(","),t=0;t<e.length;t++){var i=new CardData(e[t]);this["card"+t].hideBack(),this["card"+t].setData(i)}var n=this._data.lwd.daos;this.refreshScore(this.firstPoint,n[0]),this.refreshScore(this.midPoint,n[1]),this.refreshScore(this.lastPoint,n[2])},n.refreshScore=function(e,t){t>=0?(e.text="+"+t,e.font="point_yellow_font_fnt"):(e.text=t,e.font="point_blue_font_fnt")},t}(meru.BaseComponent);egret.registerClass(ReviewUserView,"ReviewUserView");var PeopleRankItem=function(e){function t(){e.apply(this,arguments),this._loader=new HeadLoader}__extends(t,e);var i=(__define,t),n=i.prototype;return n.dataChanged=function(){this.data&&(this.rank.text=this.data.rank,this.host.visible=PRoom.getCache("base.owner")==this.data.uId,this.nameLabel.text=GameUtils.formatName(this.data.nm,this.data),this.detailLabel.text=this.data.wn+"胜"+this.data.fn+"负",this.data.lsc>0?this.score.text="+"+this.data.lsc:this.score.text=this.data.lsc,1==this.data.pic?this._loader.init(this.head,"head_2_png",4):this._loader.init(this.head,this.data.pic,4))},t}(meru.ItemRenderer);egret.registerClass(PeopleRankItem,"PeopleRankItem");var RoundHistoryView=function(e){function t(){e.call(this),this.skinName="PanelScoreSkin"}__extends(t,e);var i=__define,n=t,s=n.prototype;return s.onEnter=function(){var t=this;e.prototype.onEnter.call(this);var i=new andes.operates.TabOperate("tab");i.clearTabItems(),i.addTabItem({label:"战绩流水",onSelect:function(e){e(),t.liushui.visible=!0,t.total.visible=!1}}),i.addTabItem({label:"总分排行",onSelect:function(e){e(),t.liushui.visible=!1,t.total.visible=!0}}),this.addOperate(i),this.groupList.dataProvider=this.gList,this.rankList.dataProvider=this.rList},s.onExit=function(){e.prototype.onExit.call(this),HistoryRoundView.openMap={}},i(s,"gList",function(){var e=[],t=meru.getCache(PRoom.roundResults());return e=t.l,new eui.ArrayCollection(e)}),i(s,"rList",function(){var e=[],t=PRoom.getCache("rus");for(var i in t){var n=t[i];e.push(n)}e.sort(function(e,t){return t.tsc-e.tsc});for(var s=0;s<e.length;s++)e[s].rank=s+1;return new eui.ArrayCollection(e)}),t}(meru.BaseComponent);egret.registerClass(RoundHistoryView,"RoundHistoryView");var RoundItem=function(e){function t(){e.call(this),this.skinName="ItemGameRecordSkin2"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this),this.listener(this.detailBtn,this.detailClick),this.listener(this.xiangxiBtn,this.xiangxiClick)},n.onExit=function(){e.prototype.onExit.call(this),this.clearListeners()},n.xiangxiClick=function(){var e=this.data.rus,t=PRoom.getCache("rus");for(var i in e)e[i].uId=t[i].uId,e[i].nm=t[i].nm,e[i].pic=t[i].pic;meru.UI.addBox(new RoundOverView(e))},n.detailClick=function(){HistoryRoundView.openMap[this.data.idx]?HistoryRoundView.openMap[this.data.idx]=!1:HistoryRoundView.openMap[this.data.idx]=!0,this.showList()},n.dataChanged=function(){if(e.prototype.dataChanged.call(this),this.data){this.xiangxiBtn.visible=!0,this.detailBtn.visible=!1;var t=this.data.rus,i=PRoom.getCache("rus"),n=[];for(var s in t){var r={};r.lsc=t[s].lsc,r.uName=i[s].nm,r.uId=i[s].uId,n.push(r)}this._l=n,this.showList(),this.detailBtn.visible=n.length>4}},n.showList=function(){HistoryRoundView.openMap[this.data.idx]?this.showAll():this.showSome()},n.showAll=function(){var e=this.list.dataProvider;e.source=this._l,e.refresh(),this.detailBtn.scaleY=-1},n.showSome=function(){var e=this.list.dataProvider;e.source=this._l.slice(0,4),e.refresh(),this.detailBtn.scaleY=1},t}(meru.BaseComponent);egret.registerClass(RoundItem,"RoundItem",["eui.IItemRenderer","eui.UIComponent"]);var SettingView=function(e){function t(){e.call(this),this.skinName="SettingSkin"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(){e.prototype.onEnter.call(this),this.refreshView(),this.musicOpen.group.addEventListener(eui.UIEvent.CHANGE,this.switchMusic,this),this.effectOpen.group.addEventListener(eui.UIEvent.CHANGE,this.switchEffect,this)},n.onExit=function(){e.prototype.onExit.call(this),this.musicOpen.group.removeEventListener(eui.UIEvent.CHANGE,this.switchMusic,this),this.effectOpen.group.removeEventListener(eui.UIEvent.CHANGE,this.switchEffect,this)},n.refreshView=function(){this.musicOpen.selected=meru.singleton(SoundManager).isMusicOpen(),this.musicClose.selected=!meru.singleton(SoundManager).isMusicOpen(),this.effectOpen.selected=meru.singleton(SoundManager).isEffectOpen(),this.effectClose.selected=!meru.singleton(SoundManager).isEffectOpen()},n.switchMusic=function(){meru.singleton(SoundManager).switchMusic(),this.refreshView()},n.switchEffect=function(){meru.singleton(SoundManager).switchEffect(),this.refreshView()},t}(meru.BaseComponent);egret.registerClass(SettingView,"SettingView");var BaseVoice=function(){function e(){this.playList=[],this.isPlaying=!1,this.state=VoiceState["default"],this.startTime=0,this.voiceTime=0,this.loadedList=[],this.currentRecordId=null,this.currentDownloadId=null}var t=(__define,e),i=t.prototype;return i.init=function(){this.onVoiceRecordEnd()},i.getLocalId=function(e){for(var t=0;t<this.loadedList.length;t++)if(this.loadedList[t].serverId==e)return this.loadedList[t].localId;return null},i.startRecord=function(){this.state=VoiceState.starting,this.startTime=(new Date).getTime()},i.startRecordCallBack=function(e){"sucess"==e.message?(console.log("开始录音"),this.state=VoiceState.recording):(console.log("拒绝授权"),this.state=VoiceState["default"])},i.stopRecord=function(){this.state=VoiceState.stopping},i.stopRecordCallBack=function(e){if(this.state=VoiceState["default"],"sucess"==e.message){var t=(new Date).getTime()-this.startTime;this.voiceTime=Math.ceil(t/1e3),this.currentRecordId=e.result,meru.postNotification("afterStopVoice")}else this.alertFail(e),VoiceEvent.end();this.startTime=0},i.onVoiceRecordEnd=function(){},i.onVoiceRecordEndCallBack=function(e){this.state=VoiceState["default"],this.voiceTime=60,"sucess"==e.message?(this.currentRecordId=e.result,meru.postNotification("voiceRecordTimeOut")):this.alertFail(e),this.startTime=0},i.uploadVoice=function(){this.state=VoiceState.upLoading},i.uploadVoiceCallBack=function(e){if(this.state=VoiceState["default"],"sucess"==e.message){var t=new VoiceData;t.localId=e.result.localId,t.serverId=e.result.serverId,this.loadedList.push(t),meru.postNotification("uploadVoiceDone",e.result.serverId,this.voiceTime)}else this.alertFail(e);this.cleanRecord()},i.cleanRecord=function(){this.currentRecordId=null},i.alertFail=function(e){},i.downloadVoice=function(e){this.state=VoiceState.downLoading},i.downloadVoiceCallBack=function(e){if(this.state=VoiceState["default"],"sucess"==e.message){var t=new VoiceData;t.localId=e.result.localId,t.serverId=e.result.serverId,this.loadedList.push(t),this.playVoice(e.result.serverId)}else this.alertFail(e);this.currentDownloadId=null},i.playVoice=function(e){this.state=VoiceState.playing,this.isPlaying=!0},i.playVoiceCallBack=function(e){if(this.state=VoiceState["default"],this.isPlaying=!1,this.playList.length>0){var t=this.playList.shift();this.playVoice(t)}},i.pauseVoice=function(e){this.state=VoiceState.pausing},i.pauseVoiceCallBack=function(){this.state=VoiceState["default"]},i.stopVoice=function(e){this.state=VoiceState.stopPlaying},i.stopVoiceCallBack=function(){this.state=VoiceState["default"]},e}();egret.registerClass(BaseVoice,"BaseVoice");var Voice=function(){function e(){}var t=(__define,e);t.prototype;return e.getVoice=function(){return this._voice?this._voice:(egret.Capabilities.runtimeType==egret.RuntimeType.WEB?this._voice=new H5Voice:this._voice=new NativeVoice,this._voice.init(),this._voice)},e}();egret.registerClass(Voice,"Voice");var VoiceData=function(){function e(){this.localId=null,this.serverId=null}var t=(__define,e);t.prototype;return e}();egret.registerClass(VoiceData,"VoiceData");var VoiceEvent=function(){function e(){}var t=(__define,e);t.prototype;return e.start=function(){var e="g.tv",t={v:1};andes.socket.GameWebSocket.get().request(e,t)},e.end=function(){var e="g.tv",t={v:0};andes.socket.GameWebSocket.get().request(e,t)},e}();egret.registerClass(VoiceEvent,"VoiceEvent");var VoiceState=function(){function e(){}var t=(__define,e);t.prototype;return e["default"]=1,e.starting=2,e.recording=3,e.stopping=4,e.upLoading=5,e.downLoading=6,e.playing=7,e.stopPlaying=8,e.pausing=9,e}();egret.registerClass(VoiceState,"VoiceState");var H5Voice=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.startRecord=function(){return this.state==VoiceState.recording?!1:(e.prototype.startRecord.call(this),OpenSdk.startRecord(this.startRecordCallBack,this),!0)},n.stopRecord=function(){var t=(new Date).getTime()-this.startTime;1e3>t?meru.setTimeout(this.stopRecord,this,1e3-t+100):(e.prototype.stopRecord.call(this),OpenSdk.stopRecord(this.stopRecordCallBack,this))},n.onVoiceRecordEnd=function(){OpenSdk.onVoiceRecordEnd(this.onVoiceRecordEndCallBack,this)},n.uploadVoice=function(){if(e.prototype.uploadVoice.call(this),!this.currentRecordId)return void meru.tooltip("你还没录音呐"+this.currentRecordId);var t={};t.localId=this.currentRecordId,GameUtils.isIOS()?t.isShowProgressTips=0:t.isShowProgressTips=1,OpenSdk.uploadVoice(t,this.uploadVoiceCallBack,this)},n.downloadVoice=function(t){e.prototype.downloadVoice.call(this,t),this.currentDownloadId=t;var i={};i.serverId=t,GameUtils.isIOS()?i.isShowProgressTips=0:i.isShowProgressTips=1,OpenSdk.downloadVoice(i,this.downloadVoiceCallBack,this)},n.playVoice=function(t){var i=this.getLocalId(t);if(i){if(this.isPlaying)return void this.playList.push(t);e.prototype.playVoice.call(this,t),OpenSdk.playVoice(i,this.playVoiceCallBack,this)}else{if(this.currentDownloadId==t)return;this.downloadVoice(t)}},n.pauseVoice=function(t){var i=this.getLocalId(t);i&&(e.prototype.pauseVoice.call(this,t),OpenSdk.pauseVoice(i,this.pauseVoiceCallBack,this))},n.stopVoice=function(t){var i=this.getLocalId(t);i&&(e.prototype.stopVoice.call(this,t),OpenSdk.stopVoice(i,this.stopVoiceCallBack,this))},t}(BaseVoice);egret.registerClass(H5Voice,"H5Voice");var NativeVoice=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t);i.prototype;return t}(BaseVoice);egret.registerClass(NativeVoice,"NativeVoice");var SocketAnalysis1=function(){function e(){var e=this;this._lastMs=-1e3,this._auto=-1,this._timeId=-1,this.pushData={},this.beforeEnter=[],meru.addPullObject("GET_SPEED_MS",function(){return e._lastMs},this)}var t=(__define,e),i=t.prototype;return i.speedChange=function(e){this._lastMs=e,meru.postNotification("SPEED_CHANGE",e)},i.analysisItem=function(e){if("r.nt"==e.t)return void SystemChatTip.marquee.show(e.d);if(this.ignore(e))return void this.onAdd(e);if("wr.d"==e.t)return void this.voiceChange(e);if(this.isChat(e))if(5==e.d.t)meru.postNotification("INFO.FACE_ANIM",e.d);else{if(GameUtils.isIOSApp()&&e.d.t==ChatConst.VOICE)return void meru.singleton(SocketSynchronize).register(e.d.psId);var t=meru.getCache(PChat.roomList()).l;t.push(e.d),meru.postNotification(GameEvents.USER_CHAT,e.d),meru.postNotification(GameEvents.CHAT_CHANGE),meru.singleton(SocketSynchronize).register(e.d.psId)}else{var i=e.d;if(!this.checkPush(e)){var n=PRoom.getCache("");if(i.st==Const.afterFree()&&n.base.st!=Const.afterFree()&&(meru.singleton(SoundManager).playBGM2(),meru.singleton(SoundManager).startEffect()),i.rId&&(n.rId=i.rId),i.psId&&(n.base.psId=i.psId),i.rd&&(n.base.rd=i.rd),i.st&&(n.base.st=i.st),i.nTurn&&(n.base.nTurn=i.nTurn),"r.a"==e.t)i.rus&&(n.rus[i.rus.pn]=i.rus),meru.postNotification(GameEvents.STATUS_CHANGE);else if("r.c"==e.t){if(n.rus[i.acPn].hp=1,i.sudr&&meru.postNotification("REMOVE_TOPSCENE"),i.rus)for(var s in i.rus)for(var r in i.rus[s])n.rus[s][r]=i.rus[s][r];if(i.shPai&&(n.si.poker=i.shPai,1==i.spl&&(n.rus[i.acPn].spl=1),meru.singleton(GameData).myCardsChange()),i.st==Const.ROOM_STATUS_WAIT){RoundOverView.register=!0,meru.postNotification(GameEvents.CONTINUE_STATUS,!0);var a="";for(var s in n.rus)n.rus[s].shPai||(a+=s+"位置没牌");if(a)return meru.request({moddo:"User.uploadLog",params:{logStr:a}}),void meru.request(PRoom.getInfo(!0)).then(function(){PRoom.getCache("rId")>0?meru.singleton(ResultPlay).setData():(meru.UI.clearBox(),meru.UI.runScene(new HomeLayer))});meru.singleton(ResultPlay).setData()}}else if("r.d"==e.t)n.rus[i.acPn].cm=1,i.st==Const.afterFree()&&(n.rus=i.rus);else if("r.e"==e.t){n.base.qtt=i.qtt;for(var s in i.rus)n.rus[s].qt=i.rus[s].qt;
if("done"==i.qac)return void meru.postNotification("QUIT.OVER");"clvote"==i.qac?(meru.UI.clearBox(),GameUtils.checkBox()):GameUtils.checkBox(),meru.getData(QuitData).quitDataChange()}else"r.g"==e.t?(delete n.rus[i.acPn],meru.postNotification(GameEvents.STATUS_CHANGE)):"r.j"==e.t&&(n.rus[i.acPn].sudr=i.sudr,GameUtils.checkBox());if(i.si&&i.si.poker){n.si||(n.si={}),n.si.poker=i.si.poker;for(var s in n.rus)i.ldo==s?n.rus[s].ldo=1:n.rus[s].ldo=0;RoundMutation.showed=!1;var o=new DealCard;DealCard.isDealing=!0,meru.singleton(GameData).myCardsChange(),meru.postNotification(GameEvents.REFRESH_USER),o.execute()}this.checkPop()||(this.fixBug(),meru.singleton(ResultPlay).isPlaying||meru.postNotification(GameEvents.DATA_CHANGE))}}},i.fixBug=function(){var e=PRoom.getCache("");e&&e.base&&(Const.beforePlay(e.base.st)||e.base.st==Const.ROOM_STATUS_PLAYING)&&(e.si&&e.si.poker||this.reconnect())},i.autoTick=function(){},i.register=function(){meru.clearTimeout(this._timeId),this._timeId=meru.setTimeout(this.reload,this,2e3)},i.reload=function(){Object.keys(this.pushData).length>0&&this.reconnect()},i.ignore=function(e){return"wr.a"==e.t||"wr.b"==e.t||"wr.c"==e.t},i.isChat=function(e){return"r.f"==e.t},i.onAdd=function(e){this.autoTick(),Const.ONOFF&&Const.ONOFF.sc>e.sc||(Const.ONOFF.sc=e.sc,Const.ONOFF.d=e.d,meru.postNotification(GameEvents.STATUS_CHANGE))},i.voiceChange=function(e){Const.ONOFF.v||(Const.ONOFF.v={}),Const.ONOFF.v[e.d.pn]=e.d.v,meru.postNotification(GameEvents.STATUS_CHANGE)},i.reconnect=function(){meru.singleton(SocketSynchronize).synchronize(this.afterSynchronize,this)},i.afterSynchronize=function(){var e=PRoom.getCache("base.psId");for(var t in this.pushData)e>=t&&delete this.pushData[t]},i.cleanPushData=function(){this.pushData={},this.beforeEnter=[]},i.checkPush=function(e){var t=e.d;if(!t.psId)return!1;var i=PRoom.getCache("");return i&&i.base&&i.base.psId+1!=t.psId?i.base.psId==t.psId?(console.log("%c 这就先不屏蔽了"+t.psId,"color: #FF0000"),!1):(this.pushData[t.psId]=e,console.log("%c 之前"+i.base.psId+",现在"+t.psId,"color: #FF0000"),this.register(),!0):i&&i.base?!1:(console.log("%c 还没有base","color: #FF0000"),this.beforeEnter.push(e),!0)},i.checkPop=function(){var e=PRoom.getCache(""),t=this.pushData[e.base.psId+1];return t?(delete this.pushData[e.base.psId+1],console.log("延迟推送"),this.analysisItem(t),!0):!1},i.pushAll=function(){this.beforeEnter.sort(function(e,t){return e.d.psId-t.d.psId});for(var e=0;e<this.beforeEnter.length;e++)this.analysisItem(this.beforeEnter[e]);this.beforeEnter=[]},e}();egret.registerClass(SocketAnalysis1,"SocketAnalysis1",["SocketInterface"]);var BaseRule=function(){function e(){}var t=__define,i=e,n=i.prototype;return n.isDao=function(e){return 3==e.length},n.verify=function(e){return!0},n.getLists=function(e){for(var t=[],i=[],n=0;n<e.length;n++)e[n].isJoker?t.push(e[n]):i.push(e[n]);return{king:t,normal:i}},t(n,"level",function(){return this.type}),n.compare=function(e,t){return e[0].type-t[0].type},e}();egret.registerClass(BaseRule,"BaseRule");var DuiziRule=function(e){function t(){e.apply(this,arguments),this.type=RuleType.Duizi,this.source=""}__extends(t,e);var i=(__define,t),n=i.prototype;return n.verify=function(e){if(!this.isDao(e))return!1;this._list=e;var t=this.getLists(e),i=t.king;if(i.length>0)return!0;for(var n={},s=0;s<e.length;s++){var r=e[s];n[r.grade]||(n[r.grade]=0),n[r.grade]+=1}if(Object.keys(n).length!=e.length-1)return!1;for(var a in n)if(1!=n[a]&&2!=n[a])return!1;return!0},n.getDui=function(e){for(var t=[],i={},n=0;n<e.length;n++){var s=e[n];if(i[s.grade]||(i[s.grade]=[]),i[s.grade].push(s),2==i[s.grade].length)return i[s.grade]}var r=this.getLists(e),a=r.king,o=r.normal;return a.length>0&&t.push(o[0]),t},n.getDan=function(e){for(var t=[],i={},n=0;n<e.length;n++){var s=e[n];i[s.grade]||(i[s.grade]=[]),i[s.grade].push(s)}for(var r in i)1==i[r].length&&t.push(i[r][0]);return t},n.compare=function(t,i){var n=this.getDui(t),s=this.getDui(i);if(n[0].grade!=s[0].grade)return n[0].grade-s[0].grade;for(var r=this.getDan(t),a=this.getDan(i),o=0;o<r.length;o++)if(r[o].singleGrade!=a[o].singleGrade)return r[o].singleGrade-a[o].singleGrade;return e.prototype.compare.call(this,r,a)},n.sound=function(e){return""},t}(BaseRule);egret.registerClass(DuiziRule,"DuiziRule",["RuleInterface"]);var SantiaoRule=function(e){function t(){e.apply(this,arguments),this.type=RuleType.Santiao,this.source=""}__extends(t,e);var i=(__define,t),n=i.prototype;return n.verify=function(e){return this._list=e,this.isDao(e)?e[0].grade==e[1].grade&&e[0].grade==e[2].grade:!1},n.compare=function(e,t){return e[0].grade-t[0].grade},n.sound=function(e){return""},t}(BaseRule);egret.registerClass(SantiaoRule,"SantiaoRule",["RuleInterface"]);var ShunziRule=function(e){function t(){e.apply(this,arguments),this.type=RuleType.Shunzi,this.source=""}__extends(t,e);var i=(__define,t),n=i.prototype;return n.verify=function(e){if(this._list=e,!this.isDao(e))return!1;var t=this.getLists(e),i=t.king,n=t.normal;if(2==i.length)return!0;if(1==i.length){var s=GameUtils.needGrade(n);return 1==s.length}if(this.isSpecial(e))return!0;for(var r=0;r<e.length-1;r++)if(e[r].grade!=e[r+1].grade+1)return!1;return!0},n.isSpecial=function(e){for(var t=[14,3,2],i=0;i<e.length;i++)if(e[i].grade!=t[i])return!1;return!0},n.getRealList=function(e){var t=this.getLists(e),i=t.king,n=t.normal,s=[];if(2==i.length)s=14==n[0].grade?[13,12]:13==n[0].grade?[1,12]:[n[0].grade+2,n[0].grade+1],n.unshift(new CardData(s[1]+26)),n.unshift(new CardData(s[0]+39));else if(1==i.length){var r=n[0].type==n[1].type;s=GameUtils.needGrade(n);var a=0,o=s[0];14==o&&(o=1),a=r&&i[0].color==n[0].color?13*(n[0].type-1)+o:1==i[0].color?39+o:26+o,n.unshift(new CardData(a))}return n},n.compare=function(t,i){var n=this.getRealList(t),s=this.getRealList(i);return this.isSpecial(n)?this.isSpecial(s)?e.prototype.compare.call(this,n,s):-1:this.isSpecial(s)?1:n[0].grade!=s[0].grade?n[0].grade-s[0].grade:e.prototype.compare.call(this,n,s)},n.sound=function(e){return""},t}(BaseRule);egret.registerClass(ShunziRule,"ShunziRule",["RuleInterface"]);var TonghuaRule=function(e){function t(){e.apply(this,arguments),this.type=RuleType.Tonghua,this.source=""}__extends(t,e);var i=(__define,t),n=i.prototype;return n.verify=function(e){if(!this.isDao(e))return!1;this._list=e;for(var t=this.getLists(e),i=t.king,n=t.normal,s=0;s<n.length-1;s++)if(n[s].type!=n[s+1].type)return!1;return i.length>1?!1:1==i.length&&i[0].color!=n[0].color?!1:!0},n.getRealList=function(e){var t=this.getLists(e),i=t.king,n=t.normal,s=n;if(i.length>0){var r=0;14!=s[0].grade?(r=13*(s[0].type-1)+1,s.unshift(new CardData(r))):(r=13*(s[0].type-1)+13,s[2]=s[1],s[1]=new CardData(r))}return s},n.compare=function(t,i){for(var n=this.getRealList(t),s=this.getRealList(i),r=0;r<n.length;r++)if(n[r].grade!=s[r].grade)return n[r].grade-s[r].grade;return e.prototype.compare.call(this,n,s)},n.sound=function(e){return""},t}(BaseRule);egret.registerClass(TonghuaRule,"TonghuaRule",["RuleInterface"]);var TonghuashunRule=function(e){function t(){e.apply(this,arguments),this.type=RuleType.Tonghuashun,this.source="",this._rule=new ShunziRule}__extends(t,e);var i=(__define,t),n=i.prototype;return n.verify=function(e){if(!this.isDao(e))return!1;this._list=e;for(var t=this.getLists(e),i=t.king,n=t.normal,s=0;s<n.length-1;s++)if(n[s].type!=n[s+1].type)return!1;if(i.length>1)return!1;if(1==i.length){if(i[0].color!=n[0].color)return!1;n.unshift(i[0])}return this._rule.verify(n)},n.compare=function(e,t){return this._rule.compare(e,t)},n.sound=function(e){return""},t}(BaseRule);egret.registerClass(TonghuashunRule,"TonghuashunRule",["RuleInterface"]);var WulongRule=function(e){function t(){e.apply(this,arguments),this.type=RuleType.Wulong,this.source=""}__extends(t,e);var i=(__define,t),n=i.prototype;return n.verify=function(e){return this.isDao(e)?!0:!1},n.compare=function(t,i){for(var n=0;n<t.length;n++)if(t[n].grade!=i[n].grade)return t[n].grade-i[n].grade;return e.prototype.compare.call(this,t,i)},n.sound=function(e){return""},t}(BaseRule);egret.registerClass(WulongRule,"WulongRule",["RuleInterface"]);var RuleType;!function(e){e[e.Wulong=0]="Wulong",e[e.Duizi=1]="Duizi",e[e.Shunzi=2]="Shunzi",e[e.Tonghua=3]="Tonghua",e[e.Tonghuashun=4]="Tonghuashun",e[e.Santiao=5]="Santiao",e[e.Tongguo=100]="Tongguo",e[e.Qinglianshun=101]="Qinglianshun",e[e.Quanshunzi=102]="Quanshunzi",e[e.Sansantiao=103]="Sansantiao",e[e.Sigetou=104]="Sigetou",e[e.Santonghua=105]="Santonghua",e[e.Quanhei=106]="Quanhei",e[e.Quanhong=107]="Quanhong",e[e.Shuangqingshun=108]="Shuangqingshun",e[e.Sanqingshun=109]="Sanqingshun",e[e.Shuangsantiao=110]="Shuangsantiao"}(RuleType||(RuleType={}));var getRuleName=function(e){return["通过","清连顺","全顺子","三三条","四个头","三同花","全黑","全红","双清顺","三清顺","双三条"][e-100]},LianshunRule=function(e){function t(){e.apply(this,arguments),this.type=RuleType.Quanshunzi}__extends(t,e);var i=(__define,t),n=i.prototype;return n.verify=function(e){for(var t=this.getLists(e),i=t.king,n=t.normal,s=[],r=14;r>=2;r--)s.push(r);for(var r=0;r<n.length;r++){var a=s.indexOf(n[r].grade);if(0>a)return!1;s.splice(a,1)}for(var o=[],r=0;r<s.length;r++)14==s[r]?o.push(new CardData(1)):o.push(new CardData(s[r]));for(var h=this.recursive(o,i.length),r=0;r<h.length;r++){var u=h[r].concat(n);if(u.sort(function(e,t){return t.grade-e.grade}),this.test(u))return!0}return!1},n.test=function(e){if(this.isSpecial(e))return!0;for(var t=0;t<e.length-1;t++)if(e[t].grade!=e[t+1].grade+1)return!1;return!0},n.recursive=function(e,t){var i=[];if(1==t){for(n=0;n<e.length;n++)i.push([e[n]]);return i}for(var n=0;n<e.length;n++){var s=e.concat([]);s.splice(0,n+1);for(var r=this.recursive(s,t-1),a=0;a<r.length;a++)i.push([e[n]].concat(r[a]))}return i},n.isSpecial=function(e){var t=e.length;if(14==e[0].grade&&2==e[t-1].grade){for(var i=1;i<e.length-1;i++)if(e[i].grade!=e[i+1].grade+1)return!1;return!0}return!1},t}(BaseRule);egret.registerClass(LianshunRule,"LianshunRule");var QinglianshunRule=function(e){function t(){e.apply(this,arguments),this._rule=new LianshunRule,this.type=RuleType.Qinglianshun}__extends(t,e);var i=(__define,t),n=i.prototype;return n.verify=function(e){if(!this._rule.verify(e))return!1;for(var t=this.getLists(e),i=t.king,n=t.normal,s=0;s<n.length-1;s++)if(n[s].type!=n[s+1].type)return!1;for(var s=0;s<i.length;s++)if(i[s].color!=n[0].color)return!1;return!0},t}(BaseRule);egret.registerClass(QinglianshunRule,"QinglianshunRule");var QuanheiRule=function(e){function t(){e.apply(this,arguments),this.type=RuleType.Quanhei}__extends(t,e);var i=(__define,t),n=i.prototype;return n.verify=function(e){for(var t=0;t<e.length;t++)if(2==e[t].color)return!1;return!0},t}(BaseRule);egret.registerClass(QuanheiRule,"QuanheiRule");var QuanhongRule=function(e){function t(){e.apply(this,arguments),this.type=RuleType.Quanhong}__extends(t,e);var i=(__define,t),n=i.prototype;return n.verify=function(e){for(var t=0;t<e.length;t++)if(1==e[t].color)return!1;return!0},t}(BaseRule);egret.registerClass(QuanhongRule,"QuanhongRule");var QuansantiaoRule=function(e){function t(){e.apply(this,arguments),this._rule=new SantiaoRule,this.type=RuleType.Sansantiao}__extends(t,e);var i=(__define,t),n=i.prototype;return n.verify=function(e){var t=meru.singleton(GameData);return this._rule.verify(t.list1)&&this._rule.verify(t.list2)&&this._rule.verify(t.list3)?!0:!1},t}(BaseRule);egret.registerClass(QuansantiaoRule,"QuansantiaoRule");var SanqingRule=function(e){function t(){e.apply(this,arguments),this._rule=new TonghuaRule,this.type=RuleType.Santonghua}__extends(t,e);var i=(__define,t),n=i.prototype;return n.verify=function(e){var t=meru.singleton(GameData);return this._rule.verify(t.list1)&&this._rule.verify(t.list2)&&this._rule.verify(t.list3)?!0:!1},t}(BaseRule);egret.registerClass(SanqingRule,"SanqingRule");var SanshunqingRule=function(e){function t(){e.apply(this,arguments),this._rule=new TonghuashunRule,this.type=RuleType.Sanqingshun}__extends(t,e);var i=(__define,t),n=i.prototype;return n.verify=function(e){var t=meru.singleton(GameData);return this._rule.verify(t.list1)&&this._rule.verify(t.list2)&&this._rule.verify(t.list3)?!0:!1},t}(BaseRule);egret.registerClass(SanshunqingRule,"SanshunqingRule");var ShuangsantiaoRule=function(e){function t(){e.apply(this,arguments),this._rule=new SantiaoRule,this.type=RuleType.Shuangsantiao}__extends(t,e);var i=(__define,t),n=i.prototype;return n.verify=function(e){var t=meru.singleton(GameData);return this._rule.verify(t.list2)&&this._rule.verify(t.list3)?!0:!1},t}(BaseRule);egret.registerClass(ShuangsantiaoRule,"ShuangsantiaoRule");var ShuangshunqingRule=function(e){function t(){e.apply(this,arguments),this._rule=new TonghuashunRule,this.type=RuleType.Shuangqingshun}__extends(t,e);var i=(__define,t),n=i.prototype;return n.verify=function(e){var t=meru.singleton(GameData);return this._rule.verify(t.list2)&&this._rule.verify(t.list3)?!0:!1},t}(BaseRule);egret.registerClass(ShuangshunqingRule,"ShuangshunqingRule");var SigetouRule=function(e){function t(){e.apply(this,arguments),this._rule=new SantiaoRule,this.type=RuleType.Sigetou}__extends(t,e);var i=(__define,t),n=i.prototype;return n.verify=function(e){var t=meru.singleton(GameData),i=this._rule.verify(t.list1)||this._rule.verify(t.list2)||this._rule.verify(t.list3);if(!i)return!1;for(var n={},s=0;s<e.length;s++){var r=e[s];n[r.grade]||(n[r.grade]=0),n[r.grade]+=1}for(var a in n)if(4==n[a])return!0;return!1},t}(BaseRule);egret.registerClass(SigetouRule,"SigetouRule");var Watcher=eui.Watcher,GameUtils=function(){function e(){}var t=(__define,e);t.prototype;return e.isRelease=function(){return"release"==egret.getOption("gv")&&"bearjoy"!=egret.getOption("pf")},e.isIOS=function(){if(egret.Capabilities.runtimeType==egret.RuntimeType.WEB){var e=navigator.userAgent.toLowerCase();return e.indexOf("windows")<0&&(e.indexOf("iphone")>=0||e.indexOf("ipad")>=0||e.indexOf("ipod")>=0)}return!1},e.getMyPos=function(){var e,t=PRoom.getCache("rus");for(var i in t)if(t[i].uId==PUser.getCache("i.id")){e=parseInt(i);break}return e},e.confirmed=function(){var e=PRoom.getCache("rus");for(var t in e)if(e[t].uId==PUser.getCache("i.id")&&1==e[t].cm)return!0;return!1},e.getWXName=function(){return meru.getPlatform().name==Const.bengbu?"蚌埠软件":meru.getPlatform().name==Const.sange?"三哥游戏":meru.getPlatform().name==Const.guilin?"桂林棋牌屋":meru.getPlatform().name==Const.nanning?"老友玩":"柚子游玩"},e.getWXNumber=function(){return meru.getPlatform().name==Const.bengbu?"bbrj999":meru.getPlatform().name==Const.sange?"sggame666":meru.getPlatform().name==Const.guilin?"GLQP888":meru.getPlatform().name==Const.nanning?"LYW00008":"YZYW9898"},e.isIOSApp=function(){var e=navigator.userAgent.toLowerCase();return e.match("gamecenter.ios.app")?!0:!1},e.checkBox=function(){var t=!1,i=!1,n=e.getMyPos(),s=PRoom.getCache(""),r=PRoom.getCache("rus");1==r[n].ldo;for(var a in r)r[a].uId==PUser.getCache("i.id")&&1!=r[a].cm&&PRoom.getCache("base").st==Const.ROOM_STATUS_WAIT&&(t=!0),r[a].hasOwnProperty("qt")&&0!=r[a].qt&&(i=!0);if(i)meru.UI.getComponent("EndRoomSkin")||(meru.UI.clearBox(),meru.getData(QuitData).setRound(!1));else if(t){if(RoundMutation.showed)return;RoundOverView.register=!0,meru.UI.getComponent("GameOver")||(meru.UI.clearBox(),s.base.rd<s.base.mrd?meru.UI.addBox(new RoundOverView).setCompName("GameOver"):meru.UI.addBox(new GameOverView).setCompName("GameOver"))}},e.replenish=function(e){return 1==e.length?"0"+e:e},e.formatTime=function(){var e=new Date,t=e.getHours()+"",i=e.getMinutes()+"",n=e.getSeconds()+"";return this.replenish(t)+":"+this.replenish(i)+":"+this.replenish(n)},e.formatTime1=function(){var e=new Date,t=e.getFullYear()+"",i=e.getMonth()+1+"",n=e.getDate()+"";return this.replenish(t)+"."+this.replenish(i)+"."+this.replenish(n)},e.formatTime2=function(e){var t=new Date(e),i=t.getFullYear()+"",n=t.getMonth()+1+"",s=t.getDate()+"",r=t.getHours(),a=t.getMinutes();return i+"-"+n+"-"+s+" "+this.replenish(r+"")+":"+this.replenish(a+"")},e.formatTime3=function(e){var t=Math.floor(e/60).toString(),i=Math.floor(e%60).toString();return this.replenish(t)+":"+this.replenish(i)},e.getRealLength=function(e){for(var t=0,i=e.length,n=-1,s=0;i>s;s++)n=e.charCodeAt(s),t+=n>=0&&128>=n?1:2;return t},e.formatName=function(t,i){if(""==t&&i&&i.ezId)return"id:"+i.ezId;for(var n=!1;e.getRealLength(t)>10;)n=!0,t=t.slice(0,t.length-1);return n&&(t+=".."),t},e.needGrade=function(e){for(var t=[[14,13,12],[13,12,11],[12,11,10],[11,10,9],[10,9,8],[9,8,7],[8,7,6],[7,6,5],[6,5,4],[5,4,3],[4,3,2],[14,3,2]],i=[e[0].grade,e[1].grade],n=0;n<t.length;n++){for(var s=t[n],r=[],a=0;a<s.length;a++)-1==i.indexOf(s[a])&&r.push(s[a]);if(1==r.length)return r}return[]},e}();egret.registerClass(GameUtils,"GameUtils");var ListenerCallback=function(){function e(){}var t=(__define,e),i=t.prototype;return i.reloadError=function(e){console.log("reloadError"),console.log(e)},i.doError=function(e){if(Main.isLoading)return void meru.setTimeout(this.doError,this,1e3,e);var t=e.errorCode;if(0!=t){var i=RES.getRes("error_code_config_json");if(i&&i[t])if(t>200){var n=i[t];if(206==t){var s=1;e.responseData.mp&&(s=e.responseData.mp.num),n=n.replace("{num}",s)}meru.UI.addGuide("TooltipSkin1").setData({tip:n})}else if(5==t||7==t){var r=meru.UI.addBox("TooltipSkin1").setData({tip:e.responseData.msg||i[t]});r.closeBtn.visible=!1}else meru.tooltip(i[t]+":"+t);else meru.tooltip("有错误哦:"+t),102==t&&meru.singleton(SocketSynchronize).synchronize()}console.log("这是s不等于0")},e}();egret.registerClass(ListenerCallback,"ListenerCallback",["andes.listener.IListenerCallback"]);var LoginCallback=function(){function e(){}var t=(__define,e),i=t.prototype;return i.login=function(e){meru.singleton(RuleCenter).initSocket();var t=meru.getModelList(andes.login.ServerInfo)[0];andes.socket.GameWebSocket.run({host:t.p.wsHost,port:t.p.wsPort}),Main.isLoading?meru.addNotification("resLoadDone",this.requestUserInfo,this):this.requestUserInfo()},i.loginParams=function(){return{jd:e.jingdu,wd:e.weidu}},i.checkLogin=function(){meru.getPlatform().login()},i.requestUserInfo=function(){var e=this;RankView.needRefresh=!0,meru.multiRequest(PUser.getInfo(!0),PRoom.getInfo(!0),PChat.roomList(!0),PFriend.getList(!0)).then(function(){var t=PUser.getCache("i.openStat");1==t&&meru.updateStatisticsEnable(!0,!0),Stat.enterGame(),meru.postNotification("removeLoadingView"),meru.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){meru.singleton(SoundManager).playBMG()},e);var i=parseInt(egret.getOption("rcode")),n=parseInt(egret.getOption("rvId")),s=egret.getOption("resultId");return PRoom.getCache("rId")>0?(i>0&&i!=PRoom.getCache("base").code&&Effect.showEffect(),console.log("进这个房间"),meru.UI.runScene(new GameView),void GameUtils.checkBox()):i>0?void meru.request(PRoom.joinOne(i)).then(function(e){meru.UI.runScene(new GameView)}).otherwise(function(e){RankView.needRefresh=!1,meru.UI.runScene(new HomeLayer),meru.postNotification("HOME.ACTIVITY")}):n>0?(ReviewCodeView.auto=!1,void meru.request(PRoom.getReplay(n)).then(function(t){1==t.est?(ReviewController.rpId=n,ReviewController.setData(t)):(meru.setTimeout(function(){meru.tooltip("录像丢失")},e,500),RankView.needRefresh=!1,meru.UI.runScene(new HomeLayer),meru.postNotification("HOME.ACTIVITY"))})):(s&&meru.request(PRoom.historySm(s)).then(function(t){1==t.est?meru.UI.addGuide(new GameOverShare(t)):meru.setTimeout(function(){meru.tooltip("结算丢失")},e,500)}),RankView.needRefresh=!1,meru.UI.runScene(new HomeLayer),void meru.postNotification("HOME.ACTIVITY"))})},e.jingdu=null,e.weidu=null,e}();egret.registerClass(LoginCallback,"LoginCallback",["andes.login.ILoginCallback"]);var PlatResource=function(){function e(){this.chatMessage1={1:"快点儿啊，都等得我花儿都谢啦",2:"你的牌儿打得也太好啦",3:"不要吵了，专心玩游戏吧",4:"各位，不好意思，我得离开会儿",5:"不要走，决战到天亮啊"},this.chatMessage2={1:"快点啊，等得我都颠了",2:"你的牌打的也太牛鬼了吧",3:"没吵多，专心玩游戏得咩",4:"兄弟姐妹，没好意思，我挨离开一下",5:"没要走，搞到天亮克"},this._fangyan=!1}var t=__define,i=e,n=i.prototype;return t(n,"message",function(){return meru.getPlatform().name==Const.sange&&this._fangyan?this.chatMessage2:this.chatMessage1}),n.preloadGroup=function(){return GameUtils.isIOS()?meru.getPlatform().name==Const.sange&&this._fangyan?"preload2":"preload1":"preload"},n.soundRes=function(e){return meru.getPlatform().name==Const.sange&&this._fangyan&&RES.hasRes("sg_"+e)?"sg_"+e:e},e}();egret.registerClass(PlatResource,"PlatResource");var PUser={getInfo:function(e,t,i,n){return _p_("User.getInfo",{},t,e,i,n)},getCache:function(e,t){return void 0===t&&(t=null),meru.getCache(e,PUser.getInfo(),t)},isCache:function(){return meru.ProxyCache.isCache(PUser.getInfo())},backHome:function(e,t,i,n){return _p_("User.backHome",{},t,e,i,n)}},PRoom={getInfo:function(e,t,i,n){return _p_("Room.getInfo",{},t,e,i,n)},getCache:function(e,t){return void 0===t&&(t=null),meru.getCache(e,PRoom.getInfo(),t)},isCache:function(){return meru.ProxyCache.isCache(PRoom.getInfo())},createNew:function(e,t,i,n,s,r,a,o){return _p_("Room.createNew",{rd:e,aa:t,scst:i,mpn:n},r,s,a,o)},createEmpty:function(e,t,i,n,s,r,a){return _p_("Room.createEmpty",{rd:e,scst:t,mpn:i},s,n,r,a)},joinOne:function(e,t,i,n,s){return _p_("Room.joinOne",{code:e},i,t,n,s)},callScore:function(e,t,i,n,s){return _p_("Room.callScore",{sc:e},i,t,n,s)},brightBrand:function(e,t,i,n,s){return _p_("Room.brightBrand",{sc:e},i,t,n,s)},robLandOwner:function(e,t,i,n,s){return _p_("Room.robLandOwner",{type:e},i,t,n,s)},playCard:function(e,t,i,n,s){return _p_("Room.playCard",{card:e},i,t,n,s)},dissolve:function(e,t,i,n){return _p_("Room.dissolve",{},t,e,i,n)},cmReady:function(e,t,i,n){return _p_("Room.cmReady",{},t,e,i,n)},quit:function(e,t,i,n,s){return _p_("Room.quit",{type:e},i,t,n,s)},leave:function(e,t,i,n){return _p_("Room.leave",{},t,e,i,n)},historyList:function(e,t,i,n){return _p_("Room.historyList",{},t,e,i,n)},getReplay:function(e,t,i,n,s){return _p_("Room.getReplay",{rplId:e},i,t,n,s)},historySm:function(e,t,i,n,s){return _p_("Room.historySm",{resultId:e},i,t,n,s)},refreshAddress:function(e,t,i,n){return _p_("Room.refreshAddress",{},t,e,i,n)},surrender:function(e,t,i,n){return _p_("Room.surrender",{},t,e,i,n)},roundResults:function(e,t,i,n,s){return _p_("Room.roundResults",{rId:e},i,t,n,s)},getHelpList:function(e,t,i,n){return _p_("Room.getHelpList",{},t,e,i,n)}},PChat={roomList:function(e,t,i,n){return _p_("Chat.roomList",{},t,e,i,n)},roomSay:function(e,t,i,n,s,r,a,o){return _p_("Chat.roomSay",{type:e,ct:t,drn:i,toId:n},r,s,a,o)}},PInvite={getInfo:function(e,t,i,n){return _p_("Invite.getInfo",{},t,e,i,n)},getCache:function(e,t){return void 0===t&&(t=null),meru.getCache(e,PInvite.getInfo(),t)},isCache:function(){return meru.ProxyCache.isCache(PInvite.getInfo())},getSelfAward:function(e,t,i,n,s){return _p_("Invite.getSelfAward",{invId:e},i,t,n,s)}},PFriend={getList:function(e,t,i,n){return _p_("Friend.getList",{},t,e,i,n)},getCache:function(e,t){return void 0===t&&(t=null),meru.getCache(e,PFriend.getList(),t)},isCache:function(){return meru.ProxyCache.isCache(PFriend.getList())}},PMail={getList:function(e,t,i,n){return _p_("Mail.getList",{},t,e,i,n)},getCache:function(e,t){return void 0===t&&(t=null),meru.getCache(e,PMail.getList(),t)},isCache:function(){return meru.ProxyCache.isCache(PMail.getList())},award:function(e,t,i,n,s){return _p_("Mail.award",{mId:e},i,t,n,s)},awardAll:function(e,t,i,n){return _p_("Mail.awardAll",{},t,e,i,n)}},ReportError=function(){function e(){}var t=(__define,e),i=t.prototype;return i.init=function(){egret.Capabilities.runtimeType==egret.RuntimeType.WEB&&(window.onerror=function(t,i,n){var s=t+i+n;-1==e._msgCache.indexOf(s)&&e._msgCache.push(s)})},i.socketError=function(e){},e._msgCache=[],e}();egret.registerClass(ReportError,"ReportError");var ShareListener=function(){function e(){}var t=(__define,e),i=t.prototype;return i.roomShare=function(e){if(console.log("create share:"+e),!GameUtils.isIOSApp()||"init"!=e){var t=PUser.getCache("i.shareInfo"),i=PRoom.getCache("base"),n=-1,s=PUser.getCache("i.pic");1==s&&(s=t.img_url);var r=t.description,a=t.url,o=PUser.getCache("i.nNa")+" 邀请你加入"+t.title,h="";if(h=a.indexOf("?")>-1?"&":"?",i){n=i.code,r="自己人才懂的玩法，熟人线上约打！房间号:"+n;var u=meru.singleton(GameData).hasRule(Const.SETTING_NORMAL),c=meru.singleton(GameData).hasRule(Const.SETTING_NO_SMALL),l=meru.singleton(GameData).hasRule(Const.SETTING_KING),d=meru.singleton(GameData).hasRule(Const.SETTING_SPECIAL);u?r+=" 普通模式":c?r+=" 去小牌":l&&(r+=" 有大小王"),d&&(r+="特殊牌算分"),1==i.aa&&(r+="【AA局】"),a+=h+"rcode="+n+"&sharefrom="+PUser.getCache("i.ezId")+"&type=room"}else a+=h+"sharefrom="+PUser.getCache("i.ezId")+"&type=friend";egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE&&(a+="&runtime=native");var m={};m.title=o,m.desc=r,m.imgUrl=s,m.link=a,m.type="appMessage",GameUtils.isIOSApp()&&(m.ios=1),GameUtils.isRelease()&&OpenSdk.share(m,function(){meru.tooltip("分享成功")},this)}},i.friendShare=function(e){if(console.log("friend share:"+e),!GameUtils.isIOSApp()||"init"!=e){var t=PUser.getCache("i.shareInfo"),i=PUser.getCache("i.pic");1==i&&(i=t.img_url);var n=t.url,s=PUser.getCache("i.ezId"),r="自己人才懂的玩法，熟人线上约打！快来加我好友！我的ID:"+s,a="";a=n.indexOf("?")>-1?"&":"?",n+=a+"sharefrom="+s+"&type=friend",egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE&&(n+="&runtime=native");var o={};o.title=t.title,o.desc=r,o.imgUrl=i,o.link=n,o.type="appMessage",GameUtils.isIOSApp()&&(o.ios=1),GameUtils.isRelease()&&OpenSdk.share(o,function(){meru.tooltip("分享成功")},this)}},i.reviewShare=function(e,t,i,n){if(console.log("review share:"+e),!GameUtils.isIOSApp()||"init"!=e){var s=PUser.getCache("i.shareInfo");1==n&&(n=s.img_url);var r=s.url,a=i+" "+s.title+"的回放",o="自己人才懂的玩法，看 "+i+" 如何虐杀四方！录像ID:"+t,h="";h=r.indexOf("?")>-1?"&":"?",r+=h+"rvId="+t+"&sharefrom="+PUser.getCache("i.ezId")+"&type=review",egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE&&(r+="&runtime=native");var u={};u.title=a,u.desc=o,u.imgUrl=n,u.link=r,u.type="appMessage",GameUtils.isIOSApp()&&(u.ios=1),GameUtils.isRelease()&&OpenSdk.share(u,function(){meru.tooltip("分享成功")},this)}},i.resultShare=function(e,t){if(console.log("review share:"+e),!GameUtils.isIOSApp()||"init"!=e){var i=PUser.getCache("i.shareInfo"),n=i.img_url,s=i.url,r=PUser.getCache("i.nNa")+" "+i.title+"的结算",a=PUser.getCache("i.nNa")+" 的牌局已经结束，点击查看积分详情",o="";o=s.indexOf("?")>-1?"&":"?",s+=o+"resultId="+t+"&sharefrom="+PUser.getCache("i.ezId")+"&type=result",egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE&&(s+="&runtime=native");var h={};h.title=r,h.desc=a,h.imgUrl=n,h.link=s,h.type="appMessage",GameUtils.isIOSApp()&&(h.ios=1),GameUtils.isRelease()&&OpenSdk.share(h,function(){meru.tooltip("分享成功")},this)}},i.createShare=function(e,t){if(console.log("create share:"+e),!GameUtils.isIOSApp()||"init"!=e){var i=PUser.getCache("i.shareInfo"),n=i.img_url,s=i.url,r=PUser.getCache("i.nNa")+" 邀请你加入"+i.title,a=i.description,o=-1;if(t){o=t.code,a="自己人才懂的玩法，熟人线上约打！房间号:"+o,a+="【AA局】";var h="";h=s.indexOf("?")>-1?"&":"?",s+=h+"rcode="+o+"&sharefrom="+PUser.getCache("i.ezId")+"&type=room",egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE&&(s+="&runtime=native")}var u={};u.title=r,u.desc=a,u.imgUrl=n,u.link=s,u.type="appMessage",GameUtils.isIOSApp()&&(u.ios=1),GameUtils.isRelease()&&OpenSdk.share(u,function(){meru.tooltip("分享成功")},this)}},e}();egret.registerClass(ShareListener,"ShareListener");var SocketCallback=function(){function e(){this._isReconnect=!1}var t=(__define,e),i=t.prototype;return i.analysis=function(e){if(console.log("Callback.analysis"),is.array(e))for(var t=0;t<e.length;t++){var i=e[t];this.analysisItem(i)}else this.analysisItem(e)},i.analysisItem=function(e){console.log(e),meru.singleton(RuleCenter).analysis.analysisItem(e)},i.onAdd=function(e){console.log("%c onAdd:"+JSON.stringify(e),"color: #FF0000"),meru.singleton(RuleCenter).analysis.onAdd({d:e.rus,sc:e.sc})},i.onClose=function(){console.log("Callback.onClose"),this._isReconnect=!0},i.onConnect=function(){console.log("Callback.onConnect"),this._isReconnect&&meru.singleton(RuleCenter).analysis.reconnect()},i.speedChange=function(e){meru.singleton(RuleCenter).analysis.speedChange(e)},i.onError=function(e,t){console.log("Callback.onError"),console.log(e),this._isReconnect=!0,meru.singleton(ReportError).socketError(t)},i.onHeartBeat=function(e){Stat.heartBeat()},e}();egret.registerClass(SocketCallback,"SocketCallback",["andes.socket.ISocketCallback"]);var SoundManager=function(){function e(){this.volume=.07,this._lastMusic="",meru.localStorage.getItem("music")||this.switchMusic(!1),meru.localStorage.getItem("effect")||this.switchEffect(),egret.MainContext.instance.stage.addEventListener(egret.Event.DEACTIVATE,this.onBlur,this),egret.MainContext.instance.stage.addEventListener(egret.Event.ACTIVATE,this.onFocus,this)}var t=(__define,e),i=t.prototype;return i.onBlur=function(){this.pauseBGM()},i.onFocus=function(){this.resumeBGM()},i.isMusicOpen=function(){return"1"==meru.localStorage.getItem("music")},i.isEffectOpen=function(){return"1"==meru.localStorage.getItem("effect")},i.switchMusic=function(e){void 0===e&&(e=!0),this.isMusicOpen()?meru.localStorage.setItem("music","2"):meru.localStorage.setItem("music","1"),e&&(this.isMusicOpen()?this.playMusic():this.dispose1())},i.switchEffect=function(){this.isEffectOpen()?meru.localStorage.setItem("effect","2"):meru.localStorage.setItem("effect","1")},i.playBGM1=function(){"music_bg_home_mp3"!=this._lastMusic&&(this._lastMusic="music_bg_home_mp3",this.dispose1(),this.playMusic())},i.playBMG=function(){""==this._lastMusic&&("MainSkin"==meru.UI.getScene().skinName?this.playBGM2():this.playBGM1())},i.getLaseBMG=function(){return this._lastMusic},i.pauseBGM=function(){this.isMusicOpen()&&this._soundChannel&&!this._soundChannel.isStopped&&(this._soundChannel.volume=0)},i.resumeBGM=function(){this.isMusicOpen()&&this._soundChannel&&!this._soundChannel.isStopped&&(this._soundChannel.volume=this.volume)},i.dispose1=function(){this._soundChannel&&(this._soundChannel.stop(),this._soundChannel=null),this._sound&&this._sound.removeEventListener(egret.Event.COMPLETE,this.soundLoaded,this)},i.dispose2=function(){this._effectChannel&&this._effectChannel.stop()},i.playBGM2=function(){"music_bg_game_mp3"!=this._lastMusic&&(this._lastMusic="music_bg_game_mp3",this.dispose1(),this.playMusic())},i.playWin=function(){"win_mp3"!=this._lastMusic&&(this._lastMusic="win_mp3",this.dispose1(),this.playMusic())},i.playLose=function(){"lose_mp3"!=this._lastMusic&&(this._lastMusic="lose_mp3",this.dispose1(),this.playMusic())},i.playOver=function(){"over_mp3"!=this._lastMusic&&(this._lastMusic="over_mp3",this.dispose1(),this.playMusic())},i.playMusic=function(){this.isMusicOpen()&&(GameUtils.isIOS()?this.soundLoaded():RES.getResAsync(this._lastMusic,this.soundLoaded,this))},i.soundLoaded=function(){this.isMusicOpen()&&(this._sound=RES.getRes(this._lastMusic),this._sound.type=egret.Sound.MUSIC,this._lastMusic.indexOf("music_bg")>-1?this._soundChannel=this._sound.play(0,-1):this._soundChannel=this._sound.play(0,1),this._soundChannel.volume=this.volume)},i.startEffect=function(){this.playEffect("start_mp3")},i.playEffect=function(e){if(this.isEffectOpen())if(e=meru.singleton(PlatResource).soundRes(e),GameUtils.isIOS()){var t=RES.getRes(e);t.type=egret.Sound.EFFECT;var i=t.play(0,1);i.volume=this.volume+.1}else RES.getResAsync(e,function(){var t=RES.getRes(e);t.type=egret.Sound.EFFECT;var i=t.play(0,1);i.volume=this.volume+.1},this)},e}();egret.registerClass(SoundManager,"SoundManager");